import{u as R}from"./warehouseStore-CKpXNz-b.js";import{u as W}from"./itemStore-Dtoogagj.js";import{u as j}from"./itemDefinitionStore-DcKb-6mb.js";import{d as q,J as E,r as H,H as h,o as J,b as v,c as s,k as L,e as o,w as l,v as m,F as P,q as z,j as g,t as I,l as c,i as D,N as A,g as C,h as r}from"./index-C65Bzyqt.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"page-container"},X={key:0},Y=q({__name:"Outbound",setup(Z){const y=R(),n=W(),b=j(),i=E({warehouseId:void 0}),a=H([]),$=h(()=>b.itemDefinitions.reduce((t,e)=>(t[e.id]=e,t),{})),_=h(()=>n.items.map(t=>({...t,name:$.value[t.itemDefinitionId]?.name||"未知物品",shortId:t.shortId}))),N=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"UUID",dataIndex:"id",key:"id",ellipsis:!0}];J(()=>{y.fetchWarehouses(),b.fetchItemDefinitions()});const p=()=>{i.warehouseId?n.fetchItems({warehouseId:i.warehouseId,status:"InStock"}):n.items=[],a.value=[]},B=t=>{a.value=t},k=h(()=>a.value.length>0),w=t=>{const e=t==="outbound"?"借出":"处置";A.confirm({title:`确认${e}`,content:`您确定要将选中的 ${a.value.length} 件物品状态更新为 "${e}" 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const u=a.value.map(f=>n.updateItemStatus(f,t));await Promise.all(u),C.success(`成功${e} ${a.value.length} 件物品!`),a.value=[],p()}catch{C.error(`${e}失败`)}}})};return(t,e)=>{const u=o("a-page-header"),f=o("a-select-option"),M=o("a-select"),O=o("a-form-item"),T=o("a-form"),V=o("a-divider"),x=o("a-button"),F=o("a-space"),U=o("a-table"),S=o("a-empty"),K=o("a-card");return r(),v("div",null,[s(u,{title:"出库操作","sub-title":"更新在库物品的状态"}),L("div",Q,[s(K,null,{default:l(()=>[s(T,{layout:"inline",model:i,onFinish:p},{default:l(()=>[s(O,{label:"选择仓库"},{default:l(()=>[s(M,{value:i.warehouseId,"onUpdate:value":e[0]||(e[0]=d=>i.warehouseId=d),placeholder:"请选择仓库",style:{width:"200px"},onChange:p,"allow-clear":""},{default:l(()=>[(r(!0),v(P,null,z(c(y).warehouses,d=>(r(),m(f,{key:d.id,value:d.id},{default:l(()=>[g(I(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"]),s(V),i.warehouseId?(r(),v("div",X,[s(F,{style:{"margin-bottom":"16px"}},{default:l(()=>[s(x,{type:"primary",disabled:!k.value,loading:c(n).loading,onClick:e[1]||(e[1]=d=>w("outbound"))},{default:l(()=>[g(" 借出选中项 ("+I(a.value.length)+") ",1)]),_:1},8,["disabled","loading"]),s(x,{type:"primary",danger:"",disabled:!k.value,loading:c(n).loading,onClick:e[2]||(e[2]=d=>w("dispose"))},{default:l(()=>[g(" 处置选中项 ("+I(a.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!c(n).loading&&_.value.length>0?(r(),m(U,{key:0,"row-selection":{selectedRowKeys:a.value,onChange:B},columns:N,"data-source":_.value,loading:c(n).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])):D("",!0),!c(n).loading&&_.value.length===0?(r(),m(S,{key:1,description:"该仓库中没有在库物品可供出库"})):D("",!0)])):(r(),m(S,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),se=G(Y,[["__scopeId","data-v-32d3caab"]]);export{se as default};
