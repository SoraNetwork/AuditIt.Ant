import{u as W}from"./warehouseStore-B4x8h7Ay.js";import{u as j}from"./itemStore-D4XyAQFZ.js";import{d as q,J as E,r as $,H as h,o as H,b as f,c as o,k as J,e as t,w as r,v as _,F as P,q as Q,j as g,t as w,l as c,i as D,N as z,g as T,h as d}from"./index-C2vDn8nD.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"page-container"},X={key:0},Y=q({__name:"Outbound",setup(Z){const y=W(),s=j(),u=E({warehouseId:void 0}),i=$(""),n=$([]),I=h(()=>s.items.map(a=>({...a,name:a.itemDefinition?.name||"未知物品",warehouseName:a.warehouse?.name||"未知仓库"}))),k=h(()=>{if(!i.value)return I.value;const a=i.value.toLowerCase();return I.value.filter(e=>e.name&&e.name.toLowerCase().includes(a)||e.shortId&&e.shortId.toLowerCase().includes(a))}),B=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"所在仓库",dataIndex:"warehouseName",key:"warehouseName"},{title:"备注",dataIndex:"remarks",key:"remarks"}];H(()=>{y.fetchWarehouses()});const p=()=>{u.warehouseId?s.fetchItems({warehouseId:u.warehouseId,status:"InStock"}):s.items=[],n.value=[],i.value=""},L=a=>{n.value=a},b=h(()=>n.value.length>0),x=a=>{const e=a==="outbound"?"借出":"处置";z.confirm({title:`确认${e}`,content:`您确定要将选中的 ${n.value.length} 件物品状态更新为 "${e}" 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const m=n.value.map(v=>s.updateItemStatus(v,a));await Promise.all(m),T.success(`成功${e} ${n.value.length} 件物品!`),n.value=[],p()}catch{T.error(`${e}失败`)}}})};return(a,e)=>{const m=t("a-page-header"),v=t("a-select-option"),O=t("a-select"),C=t("a-form-item"),V=t("a-input-search"),F=t("a-form"),M=t("a-divider"),S=t("a-button"),K=t("a-space"),R=t("a-table"),N=t("a-empty"),U=t("a-card");return d(),f("div",null,[o(m,{title:"出库操作","sub-title":"更新在库物品的状态"}),J("div",G,[o(U,null,{default:r(()=>[o(F,{layout:"inline",model:u,onFinish:p},{default:r(()=>[o(C,{label:"选择仓库"},{default:r(()=>[o(O,{value:u.warehouseId,"onUpdate:value":e[0]||(e[0]=l=>u.warehouseId=l),placeholder:"请选择仓库",style:{width:"200px"},onChange:p,"allow-clear":""},{default:r(()=>[(d(!0),f(P,null,Q(c(y).warehouses,l=>(d(),_(v,{key:l.id,value:l.id},{default:r(()=>[g(w(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(C,{label:"搜索"},{default:r(()=>[o(V,{value:i.value,"onUpdate:value":e[1]||(e[1]=l=>i.value=l),placeholder:"按名称或短ID搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"]),o(M),u.warehouseId?(d(),f("div",X,[o(K,{style:{"margin-bottom":"16px"}},{default:r(()=>[o(S,{type:"primary",disabled:!b.value,loading:c(s).loading,onClick:e[2]||(e[2]=l=>x("outbound"))},{default:r(()=>[g(" 借出选中项 ("+w(n.value.length)+") ",1)]),_:1},8,["disabled","loading"]),o(S,{type:"primary",danger:"",disabled:!b.value,loading:c(s).loading,onClick:e[3]||(e[3]=l=>x("dispose"))},{default:r(()=>[g(" 处置选中项 ("+w(n.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),c(s).loading?D("",!0):(d(),_(R,{key:0,"row-selection":{selectedRowKeys:n.value,onChange:L},columns:B,"data-source":k.value,loading:c(s).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])),!c(s).loading&&k.value.length===0?(d(),_(N,{key:1,description:"该仓库中没有符合条件的在库物品"})):D("",!0)])):(d(),_(N,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),ne=A(Y,[["__scopeId","data-v-4216974c"]]);export{ne as default};
