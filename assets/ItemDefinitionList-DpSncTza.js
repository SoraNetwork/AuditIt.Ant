import{u as H}from"./itemDefinitionStore-Co7NJZPD.js";import{u as R}from"./categoryStore-B1fSjX2Y.js";import{d as U,r as _,J,s as z,o as h,v as N,w as a,c as o,e as l,l as v,b as j,F as G,q as K,j as q,t as P,E as Q,h as g,H as C,i as W,k as D,g as p}from"./index-CBECFl9m.js";const X=U({__name:"ItemDefinitionForm",props:{initialValues:{type:Object,default:()=>({})}},setup(S,{expose:n}){const u=S,d=_(),t=J({name:"",categoryId:void 0,unit:"",description:""}),i=R(),m={name:[{required:!0,message:"请输入物品名称！"}],categoryId:[{required:!0,message:"请选择一个分类！"}],unit:[{required:!0,message:"请输入单位！"}]};return z(()=>u.initialValues,f=>{f&&Object.assign(t,f)},{immediate:!0,deep:!0}),h(()=>{i.categories.length===0&&i.fetchCategories()}),n({validate:async()=>{if(d.value)return await d.value.validate(),Q(t)}}),(f,s)=>{const y=l("a-input"),c=l("a-form-item"),k=l("a-select-option"),I=l("a-select"),x=l("a-textarea"),b=l("a-form");return g(),N(b,{ref_key:"formRef",ref:d,model:t,rules:m,layout:"vertical",name:"item_definition_form"},{default:a(()=>[o(c,{label:"物品名称",name:"name"},{default:a(()=>[o(y,{value:t.name,"onUpdate:value":s[0]||(s[0]=e=>t.name=e)},null,8,["value"])]),_:1}),o(c,{label:"分类",name:"categoryId"},{default:a(()=>[o(I,{value:t.categoryId,"onUpdate:value":s[1]||(s[1]=e=>t.categoryId=e),placeholder:"请选择一个分类",loading:v(i).loading},{default:a(()=>[(g(!0),j(G,null,K(v(i).categories,e=>(g(),N(k,{key:e.id,value:e.id},{default:a(()=>[q(P(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(c,{label:"单位",name:"unit"},{default:a(()=>[o(y,{value:t.unit,"onUpdate:value":s[2]||(s[2]=e=>t.unit=e)},null,8,["value"])]),_:1}),o(c,{label:"描述",name:"description"},{default:a(()=>[o(x,{value:t.description,"onUpdate:value":s[3]||(s[3]=e=>t.description=e)},null,8,["value"])]),_:1})]),_:1},8,["model"])}}}),Y=["onClick"],ae=U({__name:"ItemDefinitionList",setup(S){const n=H(),u=R(),d=_(null),t=_(!1),i=_(null),m=_({}),V=C(()=>i.value!==null?"编辑物品定义":"添加物品定义"),f=C(()=>u.categories.reduce((e,r)=>(e[r.id]=r.name,e),{})),s=C(()=>n.itemDefinitions.map(e=>({...e,categoryName:f.value[e.categoryId]||"N/A"}))),y=[{title:"名称",dataIndex:"name",key:"name"},{title:"分类",dataIndex:"categoryName",key:"category"},{title:"单位",dataIndex:"unit",key:"unit"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:"150px"}],c=()=>{i.value=null,m.value={name:"",categoryId:void 0,unit:"",description:""},t.value=!0},k=e=>{i.value=e.id,m.value={...e},t.value=!0},I=async e=>{await n.deleteItemDefinition(e),n.error?p.error(n.error):p.success("物品定义删除成功")},x=async()=>{try{const e=await d.value?.validate();if(!e)return;i.value!==null?await n.updateItemDefinition({id:i.value,...e}):await n.addItemDefinition(e),n.error?p.error(n.error):(p.success(`物品定义${i.value!==null?"更新":"添加"}成功`),t.value=!1)}catch(e){console.log("表单校验失败:",e),p.error("请检查表单填写是否正确")}},b=()=>{t.value=!1};return h(()=>{n.fetchItemDefinitions(),u.categories.length===0&&u.fetchCategories()}),(e,r)=>{const F=l("a-col"),B=l("a-button"),O=l("a-row"),$=l("a-popconfirm"),E=l("a-space"),A=l("a-table"),L=l("a-modal");return g(),j("div",null,[o(A,{columns:y,"data-source":s.value,loading:v(n).loading||v(u).loading,"row-key":"id"},{title:a(()=>[o(O,{justify:"space-between"},{default:a(()=>[o(F,null,{default:a(()=>r[1]||(r[1]=[D("h2",null,"物品定义管理",-1)])),_:1,__:[1]}),o(F,null,{default:a(()=>[o(B,{type:"primary",onClick:c},{default:a(()=>r[2]||(r[2]=[q("添加物品定义",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),bodyCell:a(({column:w,record:M})=>[w.key==="action"?(g(),N(E,{key:0},{default:a(()=>[D("a",{onClick:T=>k(M)},"编辑",8,Y),o($,{title:"您确定要删除这个物品定义吗？",onConfirm:T=>I(M.id),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>r[3]||(r[3]=[D("a",{style:{color:"red"}},"删除",-1)])),_:2,__:[3]},1032,["onConfirm"])]),_:2},1024)):W("",!0)]),_:1},8,["data-source","loading"]),o(L,{open:t.value,"onUpdate:open":r[0]||(r[0]=w=>t.value=w),title:V.value,"confirm-loading":v(n).loading,onOk:x,onCancel:b,"ok-text":"保存","cancel-text":"取消"},{default:a(()=>[o(X,{ref_key:"itemDefFormRef",ref:d,"initial-values":m.value},null,8,["initial-values"])]),_:1},8,["open","title","confirm-loading"])])}}});export{ae as default};
