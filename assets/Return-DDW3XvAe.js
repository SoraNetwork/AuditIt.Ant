import{u as N}from"./itemStore-NEzmESP2.js";import{u as B}from"./warehouseStore-DxOHTXfn.js";import{u as M}from"./itemDefinitionStore-6B2W1uju.js";import{d as R,r as V,B as s,h as O,a as T,c as r,e as K,b as n,w as u,l as p,m as _,u as c,f as L,G as U,M as W,j as h,o as i}from"./index-BvLK3PZa.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"page-container"},E=R({__name:"Return",setup(G){const t=N(),d=B(),m=M(),a=V([]),f=s(()=>m.itemDefinitions.reduce((e,o)=>(e[o.id]=o,e),{})),g=s(()=>d.warehouses.reduce((e,o)=>(e[o.id]=o,e),{})),l=s(()=>t.items.map(e=>({...e,name:f.value[e.itemDefinitionId]?.name||"未知物品",warehouseName:g.value[e.warehouseId]?.name||"未知仓库"}))),v=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"原属仓库",dataIndex:"warehouseName",key:"warehouse"},{title:"UUID",dataIndex:"id",key:"id",ellipsis:!0}],y=e=>{a.value=e},I=s(()=>a.value.length>0),w=()=>{W.confirm({title:"确认归还",content:`您确定要归还选中的 ${a.value.length} 件物品吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const e=a.value.map(o=>t.updateItemStatus(o,"return"));await Promise.all(e),h.success(`成功归还 ${a.value.length} 件物品!`),a.value=[],t.fetchItems({status:"LoanedOut"})}catch{h.error("归还失败")}}})};return O(()=>{t.fetchItems({status:"LoanedOut"}),d.fetchWarehouses(),m.fetchItemDefinitions()}),(e,o)=>{const k=n("a-page-header"),x=n("a-button"),b=n("a-space"),D=n("a-table"),S=n("a-empty"),C=n("a-card");return i(),T("div",null,[r(k,{title:"归还操作","sub-title":"将借出的物品归还入库"}),K("div",j,[r(C,null,{default:u(()=>[r(b,{style:{"margin-bottom":"16px"}},{default:u(()=>[r(x,{type:"primary",disabled:!I.value,loading:c(t).loading,onClick:w},{default:u(()=>[L(" 归还选中项 ("+U(a.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!c(t).loading&&l.value.length>0?(i(),p(D,{key:0,"row-selection":{selectedRowKeys:a.value,onChange:y},columns:v,"data-source":l.value,loading:c(t).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])):_("",!0),!c(t).loading&&l.value.length===0?(i(),p(S,{key:1,description:"当前没有已借出的物品"})):_("",!0)]),_:1})])])}}}),H=$(E,[["__scopeId","data-v-40a3de60"]]);export{H as default};
