import{u as K,g as L}from"./itemStore-D4D09Hhh.js";import{u as W}from"./warehouseStore-GG9aeH09.js";import{u as $}from"./itemDefinitionStore-C-qbfLuz.js";import{d as q,r as E,K as i,o as P,e as j,c as l,n as z,g as s,f as n,i as _,y as g,l as f,p as r,m as v,x as w,N as A,k as d}from"./index-BkGqunJk.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"page-container"},H=q({__name:"Return",setup(J){const t=K(),h=W(),y=$(),o=E([]),S=i(()=>y.itemDefinitions.reduce((e,a)=>(e[a.id]=a,e),{})),x=i(()=>h.warehouses.reduce((e,a)=>(e[a.id]=a,e),{})),m=i(()=>t.items.map(e=>({...e,name:S.value[e.itemDefinitionId]?.name||"未知物品",warehouseName:x.value[e.warehouseId]?.name||"未知仓库"}))),b=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"当前状态",dataIndex:"status",key:"status"},{title:"目的地/借出信息",dataIndex:"currentDestination",key:"currentDestination"},{title:"原属仓库",dataIndex:"warehouseName",key:"warehouse"}],D=e=>{o.value=e},C=i(()=>o.value.length>0),I=async()=>{t.loading=!0;try{await t.fetchItems({status:"LoanedOut"});const e=[...t.items];await t.fetchItems({status:"SuspectedMissing"});const a=[...t.items],p=[...e,...a],c=new Set;t.items=p.filter(u=>c.has(u.id)?!1:(c.add(u.id),!0))}catch{_.error("加载物品失败")}finally{t.loading=!1}},N=()=>{A.confirm({title:"确认归还",content:`您确定要归还选中的 ${o.value.length} 件物品吗？它们的状态将被更新为“在库”。`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const e=o.value.map(a=>t.updateItemStatus(a,"return"));await Promise.all(e),_.success(`成功归还 ${o.value.length} 件物品!`),o.value=[],I()}catch{_.error("归还失败")}}})},M=e=>{switch(e){case"InStock":return"green";case"LoanedOut":return"blue";case"Disposed":return"grey";case"SuspectedMissing":return"red";default:return"default"}};return P(()=>{I(),h.fetchWarehouses(),y.fetchItemDefinitions()}),(e,a)=>{const p=s("a-page-header"),c=s("a-button"),u=s("a-space"),R=s("a-tag"),B=s("a-table"),O=s("a-empty"),T=s("a-card");return d(),j("div",null,[l(p,{title:"归还操作","sub-title":"将借出或疑似丢失的物品归还入库"}),z("div",G,[l(T,null,{default:n(()=>[l(u,{style:{"margin-bottom":"16px"}},{default:n(()=>[l(c,{type:"primary",disabled:!C.value,loading:r(t).loading,onClick:N},{default:n(()=>[v(" 归还选中项 ("+w(o.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!r(t).loading&&m.value.length>0?(d(),g(B,{key:0,"row-selection":{selectedRowKeys:o.value,onChange:D},columns:b,"data-source":m.value,loading:r(t).loading,"row-key":"id"},{bodyCell:n(({column:V,record:k})=>[V.key==="status"?(d(),g(R,{key:0,color:M(k.status)},{default:n(()=>[v(w(r(L)(k.status)),1)]),_:2},1032,["color"])):f("",!0)]),_:1},8,["row-selection","data-source","loading"])):f("",!0),!r(t).loading&&m.value.length===0?(d(),g(O,{key:1,description:"当前没有已借出或疑似丢失的物品"})):f("",!0)]),_:1})])])}}}),ee=F(H,[["__scopeId","data-v-a288db8e"]]);export{ee as default};
