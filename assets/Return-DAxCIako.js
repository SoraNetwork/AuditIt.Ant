import{u as N}from"./itemStore-4ei-M8Q9.js";import{u as R}from"./warehouseStore-CHrg5X1h.js";import{u as B}from"./itemDefinitionStore-ZWWDEMQm.js";import{d as M,r as O,K as s,o as V,e as K,c as r,n as T,g as n,f as i,y as p,l as _,p as c,m as L,x as U,O as W,i as h,k as u}from"./index-DX_CBOfY.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"page-container"},P=M({__name:"Return",setup(j){const t=N(),d=R(),m=B(),a=O([]),f=s(()=>m.itemDefinitions.reduce((e,o)=>(e[o.id]=o,e),{})),g=s(()=>d.warehouses.reduce((e,o)=>(e[o.id]=o,e),{})),l=s(()=>t.items.map(e=>({...e,name:f.value[e.itemDefinitionId]?.name||"未知物品",warehouseName:g.value[e.warehouseId]?.name||"未知仓库"}))),v=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"原属仓库",dataIndex:"warehouseName",key:"warehouse"},{title:"UUID",dataIndex:"id",key:"id",ellipsis:!0}],y=e=>{a.value=e},I=s(()=>a.value.length>0),k=()=>{W.confirm({title:"确认归还",content:`您确定要归还选中的 ${a.value.length} 件物品吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const e=a.value.map(o=>t.updateItemStatus(o,"return"));await Promise.all(e),h.success(`成功归还 ${a.value.length} 件物品!`),a.value=[],t.fetchItems({status:"LoanedOut"})}catch{h.error("归还失败")}}})};return V(()=>{t.fetchItems({status:"LoanedOut"}),d.fetchWarehouses(),m.fetchItemDefinitions()}),(e,o)=>{const w=n("a-page-header"),x=n("a-button"),D=n("a-space"),S=n("a-table"),b=n("a-empty"),C=n("a-card");return u(),K("div",null,[r(w,{title:"归还操作","sub-title":"将借出的物品归还入库"}),T("div",E,[r(C,null,{default:i(()=>[r(D,{style:{"margin-bottom":"16px"}},{default:i(()=>[r(x,{type:"primary",disabled:!I.value,loading:c(t).loading,onClick:k},{default:i(()=>[L(" 归还选中项 ("+U(a.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!c(t).loading&&l.value.length>0?(u(),p(S,{key:0,"row-selection":{selectedRowKeys:a.value,onChange:y},columns:v,"data-source":l.value,loading:c(t).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])):_("",!0),!c(t).loading&&l.value.length===0?(u(),p(b,{key:1,description:"当前没有已借出的物品"})):_("",!0)]),_:1})])])}}}),H=$(P,[["__scopeId","data-v-40a3de60"]]);export{H as default};
