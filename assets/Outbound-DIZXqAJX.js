import{u as W}from"./warehouseStore-CPs8bPgK.js";import{u as E}from"./itemStore-CX2eft65.js";import{d as P,L as Q,r as N,K as h,o as j,e as f,c as o,n as q,g as t,f as r,y as p,F as z,v as A,m as g,x as w,p as c,l as D,O as G,i as L,k as d}from"./index-BNi9Gg3W.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"page-container"},X={key:0},Y=P({__name:"Outbound",setup(Z){const y=W(),s=E(),u=Q({warehouseId:void 0}),i=N(""),n=N([]),I=h(()=>s.items.map(a=>({...a,name:a.itemDefinition?.name||"未知物品",warehouseName:a.warehouse?.name||"未知仓库"}))),k=h(()=>{if(!i.value)return I.value;const a=i.value.toLowerCase();return I.value.filter(e=>e.name&&e.name.toLowerCase().includes(a)||e.shortId&&e.shortId.toLowerCase().includes(a))}),O=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"所在仓库",dataIndex:"warehouseName",key:"warehouseName"},{title:"备注",dataIndex:"remarks",key:"remarks"}];j(()=>{y.fetchWarehouses()});const _=()=>{u.warehouseId?s.fetchItems({warehouseId:u.warehouseId,status:"InStock"}):s.items=[],n.value=[],i.value=""},T=a=>{n.value=a},b=h(()=>n.value.length>0),x=a=>{const e=a==="outbound"?"借出":"处置";G.confirm({title:`确认${e}`,content:`您确定要将选中的 ${n.value.length} 件物品状态更新为 "${e}" 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const m=n.value.map(v=>s.updateItemStatus(v,a));await Promise.all(m),L.success(`成功${e} ${n.value.length} 件物品!`),n.value=[],_()}catch{L.error(`${e}失败`)}}})};return(a,e)=>{const m=t("a-page-header"),v=t("a-select-option"),B=t("a-select"),C=t("a-form-item"),V=t("a-input-search"),F=t("a-form"),K=t("a-divider"),S=t("a-button"),M=t("a-space"),R=t("a-table"),$=t("a-empty"),U=t("a-card");return d(),f("div",null,[o(m,{title:"出库操作","sub-title":"更新在库物品的状态"}),q("div",J,[o(U,null,{default:r(()=>[o(F,{layout:"inline",model:u,onFinish:_},{default:r(()=>[o(C,{label:"选择仓库"},{default:r(()=>[o(B,{value:u.warehouseId,"onUpdate:value":e[0]||(e[0]=l=>u.warehouseId=l),placeholder:"请选择仓库",style:{width:"200px"},onChange:_,"allow-clear":""},{default:r(()=>[(d(!0),f(z,null,A(c(y).warehouses,l=>(d(),p(v,{key:l.id,value:l.id},{default:r(()=>[g(w(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(C,{label:"搜索"},{default:r(()=>[o(V,{value:i.value,"onUpdate:value":e[1]||(e[1]=l=>i.value=l),placeholder:"按名称或短ID搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"]),o(K),u.warehouseId?(d(),f("div",X,[o(M,{style:{"margin-bottom":"16px"}},{default:r(()=>[o(S,{type:"primary",disabled:!b.value,loading:c(s).loading,onClick:e[2]||(e[2]=l=>x("outbound"))},{default:r(()=>[g(" 借出选中项 ("+w(n.value.length)+") ",1)]),_:1},8,["disabled","loading"]),o(S,{type:"primary",danger:"",disabled:!b.value,loading:c(s).loading,onClick:e[3]||(e[3]=l=>x("dispose"))},{default:r(()=>[g(" 处置选中项 ("+w(n.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),c(s).loading?D("",!0):(d(),p(R,{key:0,"row-selection":{selectedRowKeys:n.value,onChange:T},columns:O,"data-source":k.value,loading:c(s).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])),!c(s).loading&&k.value.length===0?(d(),p($,{key:1,description:"该仓库中没有符合条件的在库物品"})):D("",!0)])):(d(),p($,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),ne=H(Y,[["__scopeId","data-v-4216974c"]]);export{ne as default};
