import{u as U}from"./warehouseStore-2mN1mKrU.js";import{u as W}from"./itemStore-BGZwst0N.js";import{d as j,L as E,r as L,K as f,o as q,e as g,c as o,n as z,g as t,f as r,y as _,F as A,v as G,m as y,x as w,p as c,l as O,O as H,D as I,i as k,Q as J,k as d}from"./index-DMT2AIMY.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"page-container"},Z={key:0},ee=j({__name:"Outbound",setup(ae){const b=U(),s=W(),u=E({warehouseId:void 0}),m=L(""),n=L([]),x=f(()=>s.items.map(a=>({...a,name:a.itemDefinition?.name||"未知物品",warehouseName:a.warehouse?.name||"未知仓库"}))),C=f(()=>{if(!m.value)return x.value;const a=m.value.toLowerCase();return x.value.filter(e=>e.name&&e.name.toLowerCase().includes(a)||e.shortId&&e.shortId.toLowerCase().includes(a))}),B=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"所在仓库",dataIndex:"warehouseName",key:"warehouseName"},{title:"备注",dataIndex:"remarks",key:"remarks"}];q(()=>{b.fetchWarehouses()});const v=()=>{u.warehouseId?s.fetchItems({warehouseId:u.warehouseId,status:"InStock"}):s.items=[],n.value=[],m.value=""},V=a=>{n.value=a},S=f(()=>n.value.length>0),$=a=>{const e=a==="outbound"?"借出":"处置";let p;H.confirm({title:`确认${e}`,content:I("div",[I("p",`您确定要将选中的 ${n.value.length} 件物品状态更新为 "${e}" 吗？`),I(J,{placeholder:"请输入目的地（例如：借给某人，或处置原因）",onChange:i=>{p=i.target.value},style:{marginTop:"16px"}})]),okText:"确认",cancelText:"取消",onOk:async()=>{if(!p)return k.error("目的地不能为空"),Promise.reject();try{const i=n.value.map(h=>s.updateItemStatus(h,a,p));await Promise.all(i),k.success(`成功${e} ${n.value.length} 件物品!`),n.value=[],v()}catch{k.error(`${e}失败`)}}})};return(a,e)=>{const p=t("a-page-header"),i=t("a-select-option"),h=t("a-select"),D=t("a-form-item"),F=t("a-input-search"),K=t("a-form"),M=t("a-divider"),N=t("a-button"),P=t("a-space"),Q=t("a-table"),T=t("a-empty"),R=t("a-card");return d(),g("div",null,[o(p,{title:"出库操作","sub-title":"更新在库物品的状态"}),z("div",Y,[o(R,null,{default:r(()=>[o(K,{layout:"inline",model:u,onFinish:v},{default:r(()=>[o(D,{label:"选择仓库"},{default:r(()=>[o(h,{value:u.warehouseId,"onUpdate:value":e[0]||(e[0]=l=>u.warehouseId=l),placeholder:"请选择仓库",style:{width:"200px"},onChange:v,"allow-clear":""},{default:r(()=>[(d(!0),g(A,null,G(c(b).warehouses,l=>(d(),_(i,{key:l.id,value:l.id},{default:r(()=>[y(w(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(D,{label:"搜索"},{default:r(()=>[o(F,{value:m.value,"onUpdate:value":e[1]||(e[1]=l=>m.value=l),placeholder:"按名称或短ID搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"]),o(M),u.warehouseId?(d(),g("div",Z,[o(P,{style:{"margin-bottom":"16px"}},{default:r(()=>[o(N,{type:"primary",disabled:!S.value,loading:c(s).loading,onClick:e[2]||(e[2]=l=>$("outbound"))},{default:r(()=>[y(" 借出选中项 ("+w(n.value.length)+") ",1)]),_:1},8,["disabled","loading"]),o(N,{type:"primary",danger:"",disabled:!S.value,loading:c(s).loading,onClick:e[3]||(e[3]=l=>$("dispose"))},{default:r(()=>[y(" 处置选中项 ("+w(n.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),c(s).loading?O("",!0):(d(),_(Q,{key:0,"row-selection":{selectedRowKeys:n.value,onChange:V},columns:B,"data-source":C.value,loading:c(s).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])),!c(s).loading&&C.value.length===0?(d(),_(T,{key:1,description:"该仓库中没有符合条件的在库物品"})):O("",!0)])):(d(),_(T,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),le=X(ee,[["__scopeId","data-v-bff67d3a"]]);export{le as default};
