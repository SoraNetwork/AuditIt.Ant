import{u as oe}from"./warehouseStore-Cb2rSe7p.js";import{u as se,g as re}from"./itemStore-DdSI7QoR.js";import{d as ne,L as K,r as S,K as k,o as le,e as f,c as s,n as ue,g as r,f as o,p as _,y as i,F as U,v as O,m as p,x as I,l as m,k as n,i as C}from"./index-DRbdH7Kp.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"page-container"},ce={key:0},pe={key:1},_e=ne({__name:"TransferWarehouse",setup(me){const v=oe(),c=se(),l=K({warehouseId:void 0,status:void 0}),g=S(""),d=S([]),x=S(!1),u=K({targetWarehouseId:void 0,remarks:""}),T=k(()=>c.items.map(a=>({...a,name:a.itemDefinition?.name||"未知物品",warehouseName:a.warehouse?.name||"未知仓库"}))),D=k(()=>{if(!g.value)return T.value;const a=g.value.toLowerCase();return T.value.filter(e=>e.name&&e.name.toLowerCase().includes(a)||e.shortId&&e.shortId.toLowerCase().includes(a))}),R=k(()=>l.warehouseId&&v.warehouses.find(e=>e.id===l.warehouseId)?.name||""),q=k(()=>v.warehouses.filter(a=>a.id!==l.warehouseId)),z=[{title:"可视化ID",dataIndex:"shortId",key:"shortId",width:120},{title:"物品名称",dataIndex:"name",key:"name"},{title:"当前状态",dataIndex:"status",key:"status",width:100},{title:"照片",dataIndex:"photoUrl",key:"photoUrl",width:80},{title:"备注",dataIndex:"remarks",key:"remarks",ellipsis:!0},{title:"操作",key:"actions",width:80}];le(()=>{v.fetchWarehouses()});const b=async()=>{if(l.warehouseId){const a={warehouseId:l.warehouseId};l.status&&(a.status=l.status),await c.fetchItems(a)}else c.items=[];d.value=[],g.value=""},E=a=>{d.value=a},L=k(()=>d.value.length>0),M=()=>{L.value&&(u.targetWarehouseId=void 0,u.remarks="",x.value=!0)},P=a=>{d.value=[a.id],M()},Q=async()=>{if(!u.targetWarehouseId){C.error("请选择目标库房");return}if(u.targetWarehouseId===l.warehouseId){C.error("目标库房不能与源库房相同");return}try{await c.transferWarehouseBatch(d.value,u.targetWarehouseId,u.remarks||void 0);const a=v.warehouses.find(e=>e.id===u.targetWarehouseId);C.success(`成功转移 ${d.value.length} 件物品到 ${a?.name||"目标库房"}`),x.value=!1,d.value=[],await b()}catch{C.error("转移失败，请重试")}},j=a=>{switch(a){case"InStock":return"green";case"LoanedOut":return"blue";case"Disposed":return"grey";case"SuspectedMissing":return"red";default:return"default"}},N=a=>"https://api.au.xingsora.cn/api".replace("/api","")+a;return(a,e)=>{const A=r("a-page-header"),w=r("a-select-option"),W=r("a-select"),y=r("a-form-item"),G=r("a-input-search"),B=r("a-form"),H=r("a-divider"),V=r("a-button"),F=r("a-tag"),J=r("a-space"),X=r("a-image"),Y=r("a-table"),$=r("a-empty"),Z=r("a-card"),ee=r("a-textarea"),ae=r("a-alert"),te=r("a-modal");return n(),f("div",null,[s(A,{title:"库房转移","sub-title":"将物品从一个库房转移到另一个库房"}),ue("div",ie,[s(Z,null,{default:o(()=>[s(B,{layout:"inline",model:l,onFinish:b},{default:o(()=>[s(y,{label:"源库房"},{default:o(()=>[s(W,{value:l.warehouseId,"onUpdate:value":e[0]||(e[0]=t=>l.warehouseId=t),placeholder:"请选择源库房",style:{width:"200px"},onChange:b,"allow-clear":""},{default:o(()=>[(n(!0),f(U,null,O(_(v).warehouses,t=>(n(),i(w,{key:t.id,value:t.id},{default:o(()=>[p(I(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(y,{label:"物品状态"},{default:o(()=>[s(W,{value:l.status,"onUpdate:value":e[1]||(e[1]=t=>l.status=t),placeholder:"选择状态",style:{width:"150px"},onChange:b,"allow-clear":""},{default:o(()=>[s(w,{value:"InStock"},{default:o(()=>e[6]||(e[6]=[p("在库",-1)])),_:1,__:[6]}),s(w,{value:"LoanedOut"},{default:o(()=>e[7]||(e[7]=[p("借出",-1)])),_:1,__:[7]}),s(w,{value:"SuspectedMissing"},{default:o(()=>e[8]||(e[8]=[p("疑似丢失",-1)])),_:1,__:[8]})]),_:1},8,["value"])]),_:1}),s(y,{label:"搜索"},{default:o(()=>[s(G,{value:g.value,"onUpdate:value":e[2]||(e[2]=t=>g.value=t),placeholder:"按名称或短ID搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"]),s(H),l.warehouseId?(n(),f("div",ce,[s(J,{style:{"margin-bottom":"16px"}},{default:o(()=>[s(V,{type:"primary",disabled:!L.value,loading:_(c).loading,onClick:M},{default:o(()=>[p(" 转移选中项 ("+I(d.value.length)+") ",1)]),_:1},8,["disabled","loading"]),l.warehouseId?(n(),i(F,{key:0,color:"blue"},{default:o(()=>[p(" 当前库房: "+I(R.value),1)]),_:1})):m("",!0)]),_:1}),_(c).loading?m("",!0):(n(),i(Y,{key:0,"row-selection":{selectedRowKeys:d.value,onChange:E},columns:z,"data-source":D.value,loading:_(c).loading,"row-key":"id"},{bodyCell:o(({column:t,record:h})=>[t.key==="status"?(n(),i(F,{key:0,color:j(h.status)},{default:o(()=>[p(I(_(re)(h.status)),1)]),_:2},1032,["color"])):m("",!0),t.key==="photoUrl"?(n(),f(U,{key:1},[h.photoUrl?(n(),i(X,{key:0,width:50,src:N(h.photoUrl),preview:{src:N(h.photoUrl)}},null,8,["src","preview"])):(n(),f("span",pe,"无"))],64)):m("",!0),t.key==="actions"?(n(),i(V,{key:2,type:"link",size:"small",onClick:he=>P(h)},{default:o(()=>e[9]||(e[9]=[p(" 转移 ",-1)])),_:2,__:[9]},1032,["onClick"])):m("",!0)]),_:1},8,["row-selection","data-source","loading"])),!_(c).loading&&D.value.length===0?(n(),i($,{key:1,description:"该库房中没有符合条件的物品"})):m("",!0)])):(n(),i($,{key:1,description:"请先选择一个源库房以加载物品"}))]),_:1})]),s(te,{open:x.value,"onUpdate:open":e[5]||(e[5]=t=>x.value=t),title:"转移物品到新库房","ok-text":"确认转移","cancel-text":"取消","confirm-loading":_(c).loading,onOk:Q},{default:o(()=>[s(B,{model:u,layout:"vertical"},{default:o(()=>[s(y,{label:"目标库房",required:""},{default:o(()=>[s(W,{value:u.targetWarehouseId,"onUpdate:value":e[3]||(e[3]=t=>u.targetWarehouseId=t),placeholder:"请选择目标库房",style:{width:"100%"}},{default:o(()=>[(n(!0),f(U,null,O(q.value,t=>(n(),i(w,{key:t.id,value:t.id},{default:o(()=>[p(I(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(y,{label:"备注（可选）"},{default:o(()=>[s(ee,{value:u.remarks,"onUpdate:value":e[4]||(e[4]=t=>u.remarks=t),placeholder:"输入转移原因或备注",rows:3,maxlength:500,"show-count":""},null,8,["value"])]),_:1}),d.value.length>0?(n(),i(ae,{key:0,message:`将转移 ${d.value.length} 件物品`,type:"info","show-icon":"",style:{"margin-top":"16px"}},null,8,["message"])):m("",!0)]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),ye=de(_e,[["__scopeId","data-v-52906440"]]);export{ye as default};
