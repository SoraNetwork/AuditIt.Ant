import{d as E,L as K,K as f,o as O,e as b,c as o,n as P,g as s,f as a,F as $,v as z,y as d,m as l,x as y,p as I,l as C,j as G,k as u}from"./index-CQ6v603l.js";import{u as H}from"./itemStore-kXOmi_Tr.js";import{u as J}from"./warehouseStore-D4zJ1D09.js";import{u as Q}from"./itemDefinitionStore-BJxNl8WX.js";import{S as X}from"./constants-JRhsEjak.js";import{f as Y}from"./formatters-CD-N6oRQ.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"page-container"},te=E({__name:"InventoryView",setup(ae){const S=G(),i=H(),v=J(),k=Q(),n=K({warehouseId:void 0,status:void 0,searchTerm:""}),h=t=>X[t]||{text:"未知",color:"gray"},T=f(()=>k.itemDefinitions.reduce((t,e)=>(t[e.id]=e,t),{})),L=f(()=>v.warehouses.reduce((t,e)=>(t[e.id]=e,t),{})),w=f(()=>i.items.map(t=>({...t,name:T.value[t.itemDefinitionId]?.name||"未知物品",warehouseName:L.value[t.warehouseId]?.name||"未知仓库"}))),x=f(()=>{if(!n.searchTerm)return w.value;const t=n.searchTerm.toLowerCase();return w.value.filter(e=>e.shortId.toLowerCase().includes(t)||e.name.toLowerCase().includes(t))}),N=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"所在仓库",dataIndex:"warehouseName",key:"warehouse"},{title:"状态",dataIndex:"status",key:"status"},{title:"当前去向",dataIndex:"currentDestination",key:"currentDestination"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"最后更新",dataIndex:"lastUpdated",key:"lastUpdated",customRender:({text:t})=>Y(t)}];O(()=>{i.fetchItems(),v.fetchWarehouses(),k.fetchItemDefinitions()});const m=()=>{const t={};n.warehouseId&&(t.warehouseId=Number(n.warehouseId)),n.status&&(t.status=n.status),i.fetchItems(t)};return(t,e)=>{const U=s("a-page-header"),V=s("a-input"),_=s("a-form-item"),c=s("a-select-option"),g=s("a-select"),D=s("a-button"),F=s("a-form"),B=s("a-divider"),M=s("router-link"),A=s("a-tag"),R=s("a-table"),W=s("a-empty"),j=s("a-skeleton"),q=s("a-card");return u(),b("div",null,[o(U,{title:"库存总览","sub-title":"查询所有仓库中的物品状态"}),P("div",ee,[o(q,null,{default:a(()=>[o(F,{layout:"inline",model:n,onFinish:m,class:"filter-form"},{default:a(()=>[o(_,{label:"搜索"},{default:a(()=>[o(V,{value:n.searchTerm,"onUpdate:value":e[0]||(e[0]=r=>n.searchTerm=r),placeholder:"搜索ID或名称",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1}),o(_,{label:"仓库"},{default:a(()=>[o(g,{value:n.warehouseId,"onUpdate:value":e[1]||(e[1]=r=>n.warehouseId=r),placeholder:"所有仓库",style:{width:"180px"},onChange:m,"allow-clear":""},{default:a(()=>[(u(!0),b($,null,z(I(v).warehouses,r=>(u(),d(c,{key:r.id,value:r.id},{default:a(()=>[l(y(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(_,{label:"物品状态"},{default:a(()=>[o(g,{value:n.status,"onUpdate:value":e[2]||(e[2]=r=>n.status=r),placeholder:"所有状态",style:{width:"150px"},onChange:m,"allow-clear":""},{default:a(()=>[o(c,{value:"InStock"},{default:a(()=>e[4]||(e[4]=[l("在库",-1)])),_:1,__:[4]}),o(c,{value:"LoanedOut"},{default:a(()=>e[5]||(e[5]=[l("借出",-1)])),_:1,__:[5]}),o(c,{value:"Disposed"},{default:a(()=>e[6]||(e[6]=[l("处置",-1)])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),o(_,null,{default:a(()=>[o(D,{type:"primary",onClick:m},{default:a(()=>e[7]||(e[7]=[l("查询",-1)])),_:1,__:[7]})]),_:1})]),_:1},8,["model"]),o(B),o(j,{loading:I(i).loading,active:"",paragraph:{rows:5}},{default:a(()=>[x.value.length>0?(u(),d(R,{key:0,columns:N,"data-source":x.value,"row-key":"id"},{bodyCell:a(({column:r,record:p})=>[r.key==="shortId"?(u(),d(M,{key:0,to:{name:"item-details",params:{id:p.id}}},{default:a(()=>[l(y(p.shortId),1)]),_:2},1032,["to"])):C("",!0),r.key==="status"?(u(),d(A,{key:1,color:h(p.status).color},{default:a(()=>[l(y(h(p.status).text),1)]),_:2},1032,["color"])):C("",!0)]),_:1},8,["data-source"])):(u(),d(W,{key:1,description:"没有找到符合条件的物品，快去入库吧！"},{default:a(()=>[o(D,{type:"primary",onClick:e[3]||(e[3]=r=>I(S).push("/inbound"))},{default:a(()=>e[8]||(e[8]=[l("立即入库",-1)])),_:1,__:[8]})]),_:1}))]),_:1},8,["loading"])]),_:1})])])}}}),ie=Z(te,[["__scopeId","data-v-f79729d9"]]);export{ie as default};
