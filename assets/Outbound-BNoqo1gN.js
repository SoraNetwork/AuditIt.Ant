import{u as K}from"./warehouseStore-DxOHTXfn.js";import{u as R}from"./itemStore-NEzmESP2.js";import{u as W}from"./itemDefinitionStore-6B2W1uju.js";import{d as j,D as G,r as L,B as h,h as P,a as v,c as s,e as q,b as o,w as l,l as m,F as z,E as A,u as c,m as D,f as g,G as I,M as H,j as C,o as r}from"./index-BvLK3PZa.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"page-container"},X={key:0},Y=j({__name:"Outbound",setup(Z){const y=K(),n=R(),b=W(),i=G({warehouseId:void 0}),a=L([]),$=h(()=>b.itemDefinitions.reduce((t,e)=>(t[e.id]=e,t),{})),_=h(()=>n.items.map(t=>({...t,name:$.value[t.itemDefinitionId]?.name||"未知物品",shortId:t.shortId}))),B=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"UUID",dataIndex:"id",key:"id",ellipsis:!0}];P(()=>{y.fetchWarehouses(),b.fetchItemDefinitions()});const p=()=>{i.warehouseId?n.fetchItems({warehouseId:i.warehouseId,status:"InStock"}):n.items=[],a.value=[]},M=t=>{a.value=t},w=h(()=>a.value.length>0),k=t=>{const e=t==="outbound"?"借出":"处置";H.confirm({title:`确认${e}`,content:`您确定要将选中的 ${a.value.length} 件物品状态更新为 "${e}" 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const u=a.value.map(f=>n.updateItemStatus(f,t));await Promise.all(u),C.success(`成功${e} ${a.value.length} 件物品!`),a.value=[],p()}catch{C.error(`${e}失败`)}}})};return(t,e)=>{const u=o("a-page-header"),f=o("a-select-option"),N=o("a-select"),O=o("a-form-item"),T=o("a-form"),V=o("a-divider"),x=o("a-button"),F=o("a-space"),U=o("a-table"),S=o("a-empty"),E=o("a-card");return r(),v("div",null,[s(u,{title:"出库操作","sub-title":"更新在库物品的状态"}),q("div",Q,[s(E,null,{default:l(()=>[s(T,{layout:"inline",model:i,onFinish:p},{default:l(()=>[s(O,{label:"选择仓库"},{default:l(()=>[s(N,{value:i.warehouseId,"onUpdate:value":e[0]||(e[0]=d=>i.warehouseId=d),placeholder:"请选择仓库",style:{width:"200px"},onChange:p,"allow-clear":""},{default:l(()=>[(r(!0),v(z,null,A(c(y).warehouses,d=>(r(),m(f,{key:d.id,value:d.id},{default:l(()=>[g(I(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"]),s(V),i.warehouseId?(r(),v("div",X,[s(F,{style:{"margin-bottom":"16px"}},{default:l(()=>[s(x,{type:"primary",disabled:!w.value,loading:c(n).loading,onClick:e[1]||(e[1]=d=>k("outbound"))},{default:l(()=>[g(" 借出选中项 ("+I(a.value.length)+") ",1)]),_:1},8,["disabled","loading"]),s(x,{type:"primary",danger:"",disabled:!w.value,loading:c(n).loading,onClick:e[2]||(e[2]=d=>k("dispose"))},{default:l(()=>[g(" 处置选中项 ("+I(a.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!c(n).loading&&_.value.length>0?(r(),m(U,{key:0,"row-selection":{selectedRowKeys:a.value,onChange:M},columns:B,"data-source":_.value,loading:c(n).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])):D("",!0),!c(n).loading&&_.value.length===0?(r(),m(S,{key:1,description:"该仓库中没有在库物品可供出库"})):D("",!0)])):(r(),m(S,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),se=J(Y,[["__scopeId","data-v-32d3caab"]]);export{se as default};
