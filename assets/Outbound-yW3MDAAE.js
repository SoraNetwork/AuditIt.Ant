import{u as W}from"./warehouseStore-BpXoAifH.js";import{u as j}from"./itemStore-LjhLjQKj.js";import{u as q}from"./itemDefinitionStore-DURs3lbI.js";import{d as E,J as H,r as J,H as f,o as L,b as v,c as s,k as P,e as o,w as l,v as m,F as U,q as z,j as g,t as I,l as u,i as C,N as A,g as D,h as d}from"./index-D2Ey1OOG.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"page-container"},X={key:0},Y=E({__name:"Outbound",setup(Z){const y=W(),n=j(),k=q(),i=H({warehouseId:void 0}),a=J([]),$=f(()=>k.itemDefinitions.reduce((t,e)=>(t[e.id]=e,t),{})),_=f(()=>n.items.map(t=>({...t,name:$.value[t.itemDefinitionId]?.name||"未知物品",shortId:t.shortId}))),N=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"所在仓库",dataIndex:"warehouseName",key:"warehouseName"},{title:"备注",dataIndex:"remarks",key:"remarks"}];L(()=>{y.fetchWarehouses(),k.fetchItemDefinitions()});const p=()=>{i.warehouseId?n.fetchItems({warehouseId:i.warehouseId,status:"InStock"}):n.items=[],a.value=[]},B=t=>{a.value=t},w=f(()=>a.value.length>0),b=t=>{const e=t==="outbound"?"借出":"处置";A.confirm({title:`确认${e}`,content:`您确定要将选中的 ${a.value.length} 件物品状态更新为 "${e}" 吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const c=a.value.map(h=>n.updateItemStatus(h,t));await Promise.all(c),D.success(`成功${e} ${a.value.length} 件物品!`),a.value=[],p()}catch{D.error(`${e}失败`)}}})};return(t,e)=>{const c=o("a-page-header"),h=o("a-select-option"),M=o("a-select"),O=o("a-form-item"),T=o("a-form"),V=o("a-divider"),x=o("a-button"),F=o("a-space"),K=o("a-table"),S=o("a-empty"),R=o("a-card");return d(),v("div",null,[s(c,{title:"出库操作","sub-title":"更新在库物品的状态"}),P("div",Q,[s(R,null,{default:l(()=>[s(T,{layout:"inline",model:i,onFinish:p},{default:l(()=>[s(O,{label:"选择仓库"},{default:l(()=>[s(M,{value:i.warehouseId,"onUpdate:value":e[0]||(e[0]=r=>i.warehouseId=r),placeholder:"请选择仓库",style:{width:"200px"},onChange:p,"allow-clear":""},{default:l(()=>[(d(!0),v(U,null,z(u(y).warehouses,r=>(d(),m(h,{key:r.id,value:r.id},{default:l(()=>[g(I(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"]),s(V),i.warehouseId?(d(),v("div",X,[s(F,{style:{"margin-bottom":"16px"}},{default:l(()=>[s(x,{type:"primary",disabled:!w.value,loading:u(n).loading,onClick:e[1]||(e[1]=r=>b("outbound"))},{default:l(()=>[g(" 借出选中项 ("+I(a.value.length)+") ",1)]),_:1},8,["disabled","loading"]),s(x,{type:"primary",danger:"",disabled:!w.value,loading:u(n).loading,onClick:e[2]||(e[2]=r=>b("dispose"))},{default:l(()=>[g(" 处置选中项 ("+I(a.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!u(n).loading&&_.value.length>0?(d(),m(K,{key:0,"row-selection":{selectedRowKeys:a.value,onChange:B},columns:N,"data-source":_.value,loading:u(n).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])):C("",!0),!u(n).loading&&_.value.length===0?(d(),m(S,{key:1,description:"该仓库中没有在库物品可供出库"})):C("",!0)])):(d(),m(S,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),se=G(Y,[["__scopeId","data-v-e99a1628"]]);export{se as default};
