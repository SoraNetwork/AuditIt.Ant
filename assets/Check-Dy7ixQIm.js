import{d as z,r as I,L as E,e as W,c as e,n as m,g as s,f as t,Q as X,R as K,m as f,y as Q,l as U,T as $,x as A,i as j,k}from"./index-BvDCns5E.js";import{u as F}from"./itemStore-C5V1qByR.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"page-container"},G={class:"item-name"},q={class:"item-short-id"},H=z({__name:"Check",setup(J){const g=F(),c=I(""),r=I(!1),p=I([]),v=new Set,n=E({success:0,failed:0,duplicate:0}),B=new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaXRyYXRlOjMyMGtiL3MA"),C=new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaXRyYXRlOjI1NmtiL3MA"),w=async()=>{const o=c.value.trim();if(o){if(r.value=!0,v.has(o)){n.duplicate++,h({shortId:o,name:"重复扫描",message:"该物品已在本次盘点中扫描过。",status:"重复",tagColor:"orange"}),c.value="",r.value=!1,C.play().catch(a=>console.error("Audio play failed:",a));return}try{await g.fetchItems({shortId:o});const a=g.items.find(d=>d.shortId===o);if(!a)throw new Error("物品未在系统中找到");const i=a.status,u=await g.updateItemStatus(a.id,"check");n.success++,v.add(o),h({shortId:o,name:u.itemDefinition?.name||"未知物品",message:`原状态: ${i} -> 新状态: ${u.status}`,status:"成功",tagColor:"green"}),B.play().catch(d=>console.error("Audio play failed:",d))}catch(a){n.failed++,h({shortId:o,name:"操作失败",message:a.message||"未知错误",status:"失败",tagColor:"red"}),C.play().catch(i=>console.error("Audio play failed:",i))}finally{c.value="",r.value=!1}}},h=o=>{p.value.unshift(o)},R=()=>{p.value=[],v.clear(),n.success=0,n.failed=0,n.duplicate=0,j.info("结果已清空")};return(o,a)=>{const i=s("a-page-header"),u=s("a-button"),d=s("a-input-search"),V=s("a-form-item"),S=s("a-divider"),y=s("a-statistic"),_=s("a-col"),b=s("a-row"),x=s("a-list-item-meta"),D=s("a-tag"),Y=s("a-list-item"),L=s("a-list"),M=s("a-empty"),N=s("a-card");return k(),W("div",null,[e(i,{title:"连续盘点","sub-title":"使用扫描枪或手动输入短ID进行快速盘点"}),m("div",T,[e(N,null,{default:t(()=>[e(b,{gutter:24},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(V,{label:"扫描或输入物品短ID"},{default:t(()=>[e(d,{value:c.value,"onUpdate:value":a[0]||(a[0]=l=>c.value=l),placeholder:"在此处扫描或输入ID...",size:"large",autofocus:"",onSearch:w,onKeydown:X(K(w,["prevent"]),["enter"])},{enterButton:t(()=>[e(u,{type:"primary"},{default:t(()=>a[1]||(a[1]=[f("盘点",-1)])),_:1,__:[1]})]),_:1},8,["value","onKeydown"])]),_:1}),e(S,null,{default:t(()=>a[2]||(a[2]=[f("统计",-1)])),_:1,__:[2]}),e(b,{gutter:16},{default:t(()=>[e(_,{span:8},{default:t(()=>[e(y,{title:"成功",value:n.success},null,8,["value"])]),_:1}),e(_,{span:8},{default:t(()=>[e(y,{title:"失败",value:n.failed},null,8,["value"])]),_:1}),e(_,{span:8},{default:t(()=>[e(y,{title:"重复",value:n.duplicate},null,8,["value"])]),_:1})]),_:1}),e(S),e(u,{onClick:R,block:""},{default:t(()=>a[3]||(a[3]=[f("清空列表",-1)])),_:1,__:[3]})]),_:1}),e(_,{span:16},{default:t(()=>[e(L,{"data-source":p.value,bordered:"",loading:r.value},{renderItem:t(({item:l})=>[e(Y,{class:$(`status-${l.status.toLowerCase()}`)},{actions:t(()=>[e(D,{color:l.tagColor},{default:t(()=>[f(A(l.status),1)]),_:2},1032,["color"])]),default:t(()=>[e(x,null,{title:t(()=>[m("span",G,A(l.name),1),m("span",q," ("+A(l.shortId)+")",1)]),description:t(()=>[m("span",null,A(l.message),1)]),_:2},1024)]),_:2},1032,["class"])]),header:t(()=>a[4]||(a[4]=[m("div",null,"盘点结果 (最新扫描的在最上方)",-1)])),_:1},8,["data-source","loading"]),p.value.length===0&&!r.value?(k(),Q(M,{key:0,description:"请开始扫描...",style:{"margin-top":"24px"}})):U("",!0)]),_:1})]),_:1})]),_:1})])])}}}),te=O(H,[["__scopeId","data-v-b6a81ac7"]]);export{te as default};
