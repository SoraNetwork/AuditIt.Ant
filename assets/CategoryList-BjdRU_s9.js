import{u as S}from"./categoryStore-dK7xlH4K.js";import{d as R,r as m,D as U,m as D,n as j,w as o,c as n,e as l,x as E,h as x,B as T,o as q,b as A,l as C,i as L,k,j as z,g as d}from"./index-BsCkXfkc.js";const G=R({__name:"CategoryForm",props:{initialValues:{type:Object,default:()=>({})}},setup(w,{expose:a}){const _=w,r=m(),t=U({name:"",description:""}),u={name:[{required:!0,message:"请输入分类名称！"}]};return D(()=>_.initialValues,c=>{c&&Object.assign(t,c)},{immediate:!0,deep:!0}),a({validate:async()=>{if(r.value)return await r.value.validate(),E(t)}}),(c,i)=>{const f=l("a-input"),p=l("a-form-item"),v=l("a-textarea"),y=l("a-form");return x(),j(y,{ref_key:"formRef",ref:r,model:t,rules:u,layout:"vertical",name:"category_form"},{default:o(()=>[n(p,{label:"分类名称",name:"name"},{default:o(()=>[n(f,{value:t.name,"onUpdate:value":i[0]||(i[0]=e=>t.name=e)},null,8,["value"])]),_:1}),n(p,{label:"描述",name:"description"},{default:o(()=>[n(v,{value:t.description,"onUpdate:value":i[1]||(i[1]=e=>t.description=e)},null,8,["value"])]),_:1})]),_:1},8,["model"])}}}),H=["onClick"],P=R({__name:"CategoryList",setup(w){const a=S(),_=m(null),r=m(!1),t=m(null),u=m({}),b=T(()=>t.value!==null?"编辑分类":"添加分类"),c=[{title:"名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:"150px"}],i=()=>{t.value=null,u.value={name:"",description:""},r.value=!0},f=e=>{t.value=e.id,u.value={...e},r.value=!0},p=async e=>{await a.deleteCategory(e),a.error?d.error(a.error):d.success("分类删除成功")},v=async()=>{try{const e=await _.value?.validate();if(!e)return;t.value!==null?await a.updateCategory({id:t.value,...e}):await a.addCategory(e),a.error?d.error(a.error):(d.success(`分类${t.value!==null?"更新":"添加"}成功`),r.value=!1)}catch(e){console.log("表单校验失败:",e),d.error("请检查表单填写是否正确")}},y=()=>{r.value=!1};return q(()=>{a.fetchCategories()}),(e,s)=>{const V=l("a-col"),M=l("a-button"),N=l("a-row"),O=l("a-popconfirm"),$=l("a-space"),h=l("a-table"),F=l("a-modal");return x(),A("div",null,[n(h,{columns:c,"data-source":C(a).categories,loading:C(a).loading,"row-key":"id"},{title:o(()=>[n(N,{justify:"space-between"},{default:o(()=>[n(V,null,{default:o(()=>s[1]||(s[1]=[k("h2",null,"分类管理",-1)])),_:1,__:[1]}),n(V,null,{default:o(()=>[n(M,{type:"primary",onClick:i},{default:o(()=>s[2]||(s[2]=[z("添加分类",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),bodyCell:o(({column:g,record:B})=>[g.key==="action"?(x(),j($,{key:0},{default:o(()=>[k("a",{onClick:I=>f(B)},"编辑",8,H),n(O,{title:"您确定要删除这个分类吗？",onConfirm:I=>p(B.id),"ok-text":"确定","cancel-text":"取消"},{default:o(()=>s[3]||(s[3]=[k("a",{style:{color:"red"}},"删除",-1)])),_:2,__:[3]},1032,["onConfirm"])]),_:2},1024)):L("",!0)]),_:1},8,["data-source","loading"]),n(F,{open:r.value,"onUpdate:open":s[0]||(s[0]=g=>r.value=g),title:b.value,"confirm-loading":C(a).loading,onOk:v,onCancel:y,"ok-text":"保存","cancel-text":"取消"},{default:o(()=>[n(G,{ref_key:"categoryFormRef",ref:_,"initial-values":u.value},null,8,["initial-values"])]),_:1},8,["open","title","confirm-loading"])])}}});export{P as default};
