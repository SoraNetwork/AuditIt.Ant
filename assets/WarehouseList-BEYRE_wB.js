import{u as $}from"./warehouseStore-DxOHTXfn.js";import{d as V,r as p,D as F,n as S,l as B,w as o,c as t,b as s,x as q,o as b,B as D,h as E,a as T,u as w,m as A,e as x,f as L,j as m}from"./index-BvLK3PZa.js";const z=V({__name:"WarehouseForm",props:{initialValues:{type:Object,default:()=>({})}},setup(h,{expose:n}){const _=h,r=p(),e=F({name:"",location:"",capacity:0,description:""}),c={name:[{required:!0,message:"请输入仓库名称！"}],location:[{required:!0,message:"请输入仓库位置！"}]};return S(()=>_.initialValues,d=>{d&&Object.assign(e,d)},{immediate:!0,deep:!0}),n({validate:async()=>{if(r.value)return await r.value.validate(),q(e)}}),(d,i)=>{const f=s("a-input"),u=s("a-form-item"),v=s("a-input-number"),y=s("a-textarea"),l=s("a-form");return b(),B(l,{ref_key:"formRef",ref:r,model:e,rules:c,layout:"vertical",name:"warehouse_form"},{default:o(()=>[t(u,{label:"仓库名称",name:"name"},{default:o(()=>[t(f,{value:e.name,"onUpdate:value":i[0]||(i[0]=a=>e.name=a)},null,8,["value"])]),_:1}),t(u,{label:"位置",name:"location"},{default:o(()=>[t(f,{value:e.location,"onUpdate:value":i[1]||(i[1]=a=>e.location=a)},null,8,["value"])]),_:1}),t(u,{label:"容量",name:"capacity"},{default:o(()=>[t(v,{value:e.capacity,"onUpdate:value":i[2]||(i[2]=a=>e.capacity=a),style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{label:"描述",name:"description"},{default:o(()=>[t(y,{value:e.description,"onUpdate:value":i[3]||(i[3]=a=>e.description=a)},null,8,["value"])]),_:1})]),_:1},8,["model"])}}}),G=["onClick"],K=V({__name:"WarehouseList",setup(h){const n=$(),_=p(null),r=p(!1),e=p(null),c=p({}),C=D(()=>e.value!==null?"编辑仓库":"添加仓库"),d=[{title:"名称",dataIndex:"name",key:"name"},{title:"位置",dataIndex:"location",key:"location"},{title:"容量",dataIndex:"capacity",key:"capacity"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:"150px"}],i=()=>{e.value=null,c.value={name:"",location:"",capacity:100,description:""},r.value=!0},f=l=>{e.value=l.id,c.value={...l},r.value=!0},u=async l=>{await n.deleteWarehouse(l),n.error?m.error(n.error):m.success("仓库删除成功")},v=async()=>{try{const l=await _.value?.validate();if(!l)return;e.value!==null?await n.updateWarehouse({id:e.value,...l}):await n.addWarehouse(l),n.error?m.error(n.error):(m.success(`仓库${e.value!==null?"更新":"添加"}成功`),r.value=!1)}catch(l){console.log("表单校验失败:",l),m.error("请检查表单填写是否正确")}},y=()=>{r.value=!1};return E(()=>{n.fetchWarehouses()}),(l,a)=>{const g=s("a-col"),I=s("a-button"),R=s("a-row"),U=s("a-popconfirm"),j=s("a-space"),M=s("a-table"),N=s("a-modal");return b(),T("div",null,[t(M,{columns:d,"data-source":w(n).warehouses,loading:w(n).loading,"row-key":"id"},{title:o(()=>[t(R,{justify:"space-between"},{default:o(()=>[t(g,null,{default:o(()=>a[1]||(a[1]=[x("h2",null,"仓库管理",-1)])),_:1,__:[1]}),t(g,null,{default:o(()=>[t(I,{type:"primary",onClick:i},{default:o(()=>a[2]||(a[2]=[L("添加仓库",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),bodyCell:o(({column:k,record:W})=>[k.key==="action"?(b(),B(j,{key:0},{default:o(()=>[x("a",{onClick:O=>f(W)},"编辑",8,G),t(U,{title:"您确定要删除这个仓库吗？",onConfirm:O=>u(W.id),"ok-text":"确定","cancel-text":"取消"},{default:o(()=>a[3]||(a[3]=[x("a",{style:{color:"red"}},"删除",-1)])),_:2,__:[3]},1032,["onConfirm"])]),_:2},1024)):A("",!0)]),_:1},8,["data-source","loading"]),t(N,{open:r.value,"onUpdate:open":a[0]||(a[0]=k=>r.value=k),title:C.value,"confirm-loading":w(n).loading,onOk:v,onCancel:y,"ok-text":"保存","cancel-text":"取消"},{default:o(()=>[t(z,{ref_key:"warehouseFormRef",ref:_,"initial-values":c.value},null,8,["initial-values"])]),_:1},8,["open","title","confirm-loading"])])}}});export{K as default};
