import{u as $}from"./itemStore-BGrQ4fFf.js";import{d as z,r as _,K as N,e as V,c as e,n as q,g as o,f as t,m as i,x as d,i as y,k as E}from"./index-hrW-1Gae.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"page-container"},L=z({__name:"Check",setup(j){const f=$(),m=_(""),v=_(!1),p=_("success"),r=_([]),c=_([]),x=N(()=>{const u=m.value.split(`
`).map(a=>a.trim()).filter(a=>a);return new Set(u).size}),C=async()=>{const u=m.value.split(`
`).map(s=>s.trim()).filter(s=>s);if(u.length===0){y.warn("请输入至少一个短ID");return}v.value=!0,r.value=[],c.value=[],p.value="success";const a=[...new Set(u)];for(const s of a)try{await f.fetchItems({shortId:s});const l=f.items.find(h=>h.shortId===s);if(!l)throw new Error("物品未找到");await f.updateItemStatus(l.id,"check"),r.value.push(l)}catch(l){c.value.push({id:s,error:l.message||"未知错误"})}c.value.length>0&&(p.value="failed"),v.value=!1,y.success(`盘点完成: 成功 ${r.value.length}, 失败 ${c.value.length}`)};return(u,a)=>{const s=o("a-page-header"),l=o("a-textarea"),h=o("a-form-item"),D=o("a-button"),I=o("a-col"),g=o("a-tag"),b=o("a-list-item"),k=o("a-list"),w=o("a-tab-pane"),S=o("a-tabs"),B=o("a-row"),K=o("a-card");return E(),V("div",null,[e(s,{title:"批量盘点","sub-title":"通过短ID快速盘点物品"}),q("div",U,[e(K,null,{default:t(()=>[e(B,{gutter:16},{default:t(()=>[e(I,{span:10},{default:t(()=>[e(h,{label:"输入短ID (每行一个)"},{default:t(()=>[e(l,{value:m.value,"onUpdate:value":a[0]||(a[0]=n=>m.value=n),rows:15,placeholder:"在此处粘贴或输入物品的短ID"},null,8,["value"])]),_:1}),e(D,{type:"primary",onClick:C,loading:v.value,block:""},{default:t(()=>[i(" 开始盘点 "+d(x.value)+" 个ID ",1)]),_:1},8,["loading"])]),_:1}),e(I,{span:14},{default:t(()=>[e(S,{activeKey:p.value,"onUpdate:activeKey":a[1]||(a[1]=n=>p.value=n)},{default:t(()=>[e(w,{key:"success",tab:`成功 (${r.value.length})`},{default:t(()=>[e(k,{"data-source":r.value,size:"small"},{renderItem:t(({item:n})=>[e(b,null,{default:t(()=>[i(d(n.itemDefinition?.name)+" ("+d(n.shortId)+") - ",1),e(g,{color:"green"},{default:t(()=>a[2]||(a[2]=[i("盘点成功",-1)])),_:1,__:[2]})]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["tab"]),e(w,{key:"failed",tab:`失败 (${c.value.length})`},{default:t(()=>[e(k,{"data-source":c.value,size:"small"},{renderItem:t(({item:n})=>[e(b,null,{default:t(()=>[i(d(n.id)+" - ",1),e(g,{color:"red"},{default:t(()=>[i(d(n.error),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),_:1})]),_:1})]),_:1})])])}}}),H=T(L,[["__scopeId","data-v-f2bf9118"]]);export{H as default};
