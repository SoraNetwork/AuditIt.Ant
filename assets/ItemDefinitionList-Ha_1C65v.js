import{u as O}from"./itemDefinitionStore-DWjNvwZJ.js";import{u as R}from"./categoryStore-B5u3jW0y.js";import{_ as T}from"./ItemDefinitionForm.vue_vue_type_script_setup_true_lang-DNrYdyrn.js";import{d as j,r as u,K as f,o as K,e as L,c as n,f as a,p,g as l,y as U,l as q,n as _,m as z,i as s,k}from"./index-D9XwG3Jh.js";const G=["onClick"],X=j({__name:"ItemDefinitionList",setup(H){const t=O(),c=R(),v=u(null),i=u(!1),r=u(null),d=u({}),C=f(()=>r.value!==null?"编辑物品定义":"添加物品定义"),I=f(()=>c.categories.reduce((e,o)=>(e[o.id]=o.name,e),{})),x=f(()=>t.itemDefinitions.map(e=>({...e,categoryName:I.value[e.categoryId]||"N/A"}))),w=[{title:"名称",dataIndex:"name",key:"name"},{title:"分类",dataIndex:"categoryName",key:"category"},{title:"单位",dataIndex:"unit",key:"unit"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:"150px"}],D=()=>{r.value=null,d.value={name:"",categoryId:void 0,unit:"",description:""},i.value=!0},b=e=>{r.value=e.id,d.value={...e},i.value=!0},N=async e=>{await t.deleteItemDefinition(e),t.error?s.error(t.error):s.success("物品定义删除成功")},h=async()=>{try{const e=await v.value?.validateFields();if(!e)return;r.value!==null?await t.updateItemDefinition({id:r.value,...e}):await t.addItemDefinition(e),t.error?s.error(t.error):(s.success(`物品定义${r.value!==null?"更新":"添加"}成功`),i.value=!1)}catch(e){console.log("表单校验失败:",e),s.error("请检查表单填写是否正确")}},M=()=>{i.value=!1};return K(()=>{t.fetchItemDefinitions(),c.categories.length===0&&c.fetchCategories()}),(e,o)=>{const y=l("a-col"),V=l("a-button"),B=l("a-row"),S=l("a-popconfirm"),$=l("a-space"),F=l("a-table"),A=l("a-modal");return k(),L("div",null,[n(F,{columns:w,"data-source":x.value,loading:p(t).loading||p(c).loading,"row-key":"id"},{title:a(()=>[n(B,{justify:"space-between"},{default:a(()=>[n(y,null,{default:a(()=>o[1]||(o[1]=[_("h2",null,"物品定义管理",-1)])),_:1,__:[1]}),n(y,null,{default:a(()=>[n(V,{type:"primary",onClick:D},{default:a(()=>o[2]||(o[2]=[z("添加物品定义",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),bodyCell:a(({column:m,record:g})=>[m.key==="action"?(k(),U($,{key:0},{default:a(()=>[_("a",{onClick:E=>b(g)},"编辑",8,G),n(S,{title:"您确定要删除这个物品定义吗？",onConfirm:E=>N(g.id),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>o[3]||(o[3]=[_("a",{style:{color:"red"}},"删除",-1)])),_:2,__:[3]},1032,["onConfirm"])]),_:2},1024)):q("",!0)]),_:1},8,["data-source","loading"]),n(A,{open:i.value,"onUpdate:open":o[0]||(o[0]=m=>i.value=m),title:C.value,"confirm-loading":p(t).loading,onOk:h,onCancel:M,"ok-text":"保存","cancel-text":"取消"},{default:a(()=>[n(T,{ref_key:"itemDefFormRef",ref:v,"initial-values":d.value},null,8,["initial-values"])]),_:1},8,["open","title","confirm-loading"])])}}});export{X as default};
