import{u as M}from"./warehouseStore-DxOHTXfn.js";import{u as W}from"./itemStore-NEzmESP2.js";import{u as j}from"./itemDefinitionStore-6B2W1uju.js";import{d as A,D as g,r as G,B as L,h as O,a as I,c as a,e as T,b as t,w as n,F as q,E as z,u as m,f as _,l as f,m as b,G as w,o as s}from"./index-BvLK3PZa.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"page-container"},K=A({__name:"Check",setup(P){const p=M(),l=W(),y=j(),r=g({warehouseId:void 0}),c=G([]),v=L(()=>y.itemDefinitions.reduce((u,e)=>(u[e.id]=e,u),{})),D=[{title:"物品名称",dataIndex:"name",key:"name"},{title:"单位",dataIndex:"unit",key:"unit"},{title:"账面数量",dataIndex:"bookedQuantity",key:"bookedQuantity"},{title:"实盘数量",dataIndex:"actualQuantity",key:"actualQuantity"},{title:"差异",dataIndex:"difference",key:"difference"}];O(()=>{p.fetchWarehouses(),y.fetchItemDefinitions()});const h=async()=>{if(!r.warehouseId){c.value=[];return}await l.fetchItems({warehouseId:r.warehouseId});const u=l.items.reduce((e,i)=>(e[i.itemDefinitionId]=(e[i.itemDefinitionId]||0)+1,e),{});c.value=Object.keys(u).map(e=>{const i=u[e];return g({itemDefinitionId:e,name:v.value[e]?.name||"未知物品",unit:v.value[e]?.unit||"N/A",bookedQuantity:i,actualQuantity:i,get difference(){return this.actualQuantity-this.bookedQuantity}})})};return(u,e)=>{const i=t("a-page-header"),x=t("a-select-option"),Q=t("a-select"),k=t("a-form-item"),C=t("a-button"),S=t("a-form"),B=t("a-divider"),N=t("a-input-number"),V=t("a-tag"),F=t("a-table"),U=t("a-card");return s(),I("div",null,[a(i,{title:"库存盘点","sub-title":"核对仓库实际库存与账面数量"}),T("div",J,[a(U,null,{default:n(()=>[a(S,{layout:"inline",model:r,onFinish:h},{default:n(()=>[a(k,{label:"选择仓库"},{default:n(()=>[a(Q,{value:r.warehouseId,"onUpdate:value":e[0]||(e[0]=o=>r.warehouseId=o),placeholder:"请选择要盘点的仓库",style:{width:"250px"},onChange:h,"allow-clear":""},{default:n(()=>[(s(!0),I(q,null,z(m(p).warehouses,o=>(s(),f(x,{key:o.id,value:o.id},{default:n(()=>[_(w(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(k,null,{default:n(()=>[a(C,{type:"primary","html-type":"submit",loading:m(l).loading},{default:n(()=>e[1]||(e[1]=[_("开始盘点",-1)])),_:1,__:[1]},8,["loading"])]),_:1})]),_:1},8,["model"]),a(B),a(F,{columns:D,"data-source":c.value,loading:m(l).loading,"row-key":"itemDefinitionId",pagination:!1},{bodyCell:n(({column:o,record:d})=>[o.key==="actualQuantity"?(s(),f(N,{key:0,value:d.actualQuantity,"onUpdate:value":E=>d.actualQuantity=E,min:0},null,8,["value","onUpdate:value"])):b("",!0),o.key==="difference"?(s(),f(V,{key:1,color:d.difference!==0?"red":"green"},{default:n(()=>[_(w(d.difference),1)]),_:2},1032,["color"])):b("",!0)]),_:1},8,["data-source","loading"])]),_:1})])])}}}),ee=H(K,[["__scopeId","data-v-8d650b62"]]);export{ee as default};
