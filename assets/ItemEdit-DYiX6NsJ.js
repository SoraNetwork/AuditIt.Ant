import{d as V,r as g,L as E,K as R,s as $,o as j,h as O,i as v,j as P,e as y,c as o,n as k,p as m,g as a,y as d,f as n,l as K,P as M,m as T,k as i}from"./index-hrW-1Gae.js";import{u as q}from"./itemStore-BGrQ4fFf.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"page-container"},D={key:0},G=V({__name:"ItemEdit",setup(H){const h=O(),p=P(),u=q(),s=g(null),l=E({remarks:""}),r=g([]),b=R(()=>s.value?.photoUrl?`${($.defaults.baseURL||"").replace("/api","")}${s.value.photoUrl}`:"");j(async()=>{const t=h.params.id;await u.fetchItems({id:t});const e=u.items.find(c=>c.id===t);e?(s.value=e,l.remarks=e.remarks||""):(v.error("未找到物品"),p.back())});const I=t=>{t.fileList.length>0?(r.value=[t.fileList[t.fileList.length-1]],l.photo=t.file.originFileObj):(r.value=[],delete l.photo)},U=async()=>{if(s.value)try{await u.updateItem(s.value.id,{remarks:l.remarks,photo:l.photo}),v.success("物品信息已更新"),p.back()}catch{v.error("更新失败")}};return(t,e)=>{const c=a("a-page-header"),x=a("a-textarea"),_=a("a-form-item"),C=a("a-upload"),L=a("a-image"),w=a("a-empty"),B=a("a-button"),F=a("a-form"),N=a("a-card"),S=a("a-skeleton");return i(),y("div",null,[o(c,{title:`编辑物品: ${s.value?.shortId}`,onBack:e[0]||(e[0]=()=>m(p).back())},null,8,["title"]),k("div",A,[!m(u).loading&&s.value?(i(),d(N,{key:0},{default:n(()=>[o(F,{model:l,onFinish:U,layout:"vertical"},{default:n(()=>[o(_,{label:"备注"},{default:n(()=>[o(x,{value:l.remarks,"onUpdate:value":e[1]||(e[1]=f=>l.remarks=f),rows:4},null,8,["value"])]),_:1}),o(_,{label:"更换照片"},{default:n(()=>[o(C,{"file-list":r.value,"onUpdate:fileList":e[2]||(e[2]=f=>r.value=f),"before-upload":()=>!1,onChange:I,"list-type":"picture-card"},{default:n(()=>[!r.value||r.value.length<1?(i(),y("div",D,[o(m(M)),e[3]||(e[3]=k("div",{style:{"margin-top":"8px"}},"上传",-1))])):K("",!0)]),_:1},8,["file-list"]),e[4]||(e[4]=k("p",null,"当前照片:",-1)),s.value.photoUrl?(i(),d(L,{key:0,width:100,src:b.value},null,8,["src"])):(i(),d(w,{key:1,description:"暂无照片"}))]),_:1,__:[4]}),o(_,null,{default:n(()=>[o(B,{type:"primary","html-type":"submit",loading:m(u).loading},{default:n(()=>e[5]||(e[5]=[T(" 保存更改 ",-1)])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})):(i(),d(S,{key:1,active:""}))])])}}}),X=z(G,[["__scopeId","data-v-6b18c7c3"]]);export{X as default};
