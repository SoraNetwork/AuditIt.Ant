import{u as M}from"./warehouseStore-CPs8bPgK.js";import{u as W}from"./itemStore-CX2eft65.js";import{u as j}from"./itemDefinitionStore-CnlTCUOE.js";import{d as A,L as h,r as E,K,o as O,e as I,c as a,n as T,g as t,f as n,F as q,v as z,y as m,m as _,x as b,p as f,l as x,k as s}from"./index-BNi9Gg3W.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"page-container"},J=A({__name:"Check",setup(P){const p=M(),l=W(),y=j(),u=h({warehouseId:void 0}),c=E([]),v=K(()=>y.itemDefinitions.reduce((r,e)=>(r[e.id]=e,r),{})),w=[{title:"物品名称",dataIndex:"name",key:"name"},{title:"单位",dataIndex:"unit",key:"unit"},{title:"账面数量",dataIndex:"bookedQuantity",key:"bookedQuantity"},{title:"实盘数量",dataIndex:"actualQuantity",key:"actualQuantity"},{title:"差异",dataIndex:"difference",key:"difference"}];O(()=>{p.fetchWarehouses(),y.fetchItemDefinitions()});const k=async()=>{if(!u.warehouseId){c.value=[];return}await l.fetchItems({warehouseId:u.warehouseId});const r=l.items.reduce((e,i)=>(e[i.itemDefinitionId]=(e[i.itemDefinitionId]||0)+1,e),{});c.value=Object.keys(r).map(e=>{const i=r[e];return h({itemDefinitionId:e,name:v.value[e]?.name||"未知物品",unit:v.value[e]?.unit||"N/A",bookedQuantity:i,actualQuantity:i,get difference(){return this.actualQuantity-this.bookedQuantity}})})};return(r,e)=>{const i=t("a-page-header"),D=t("a-select-option"),Q=t("a-select"),g=t("a-form-item"),C=t("a-button"),S=t("a-form"),N=t("a-divider"),B=t("a-input-number"),V=t("a-tag"),F=t("a-table"),U=t("a-card");return s(),I("div",null,[a(i,{title:"库存盘点","sub-title":"核对仓库实际库存与账面数量"}),T("div",H,[a(U,null,{default:n(()=>[a(S,{layout:"inline",model:u,onFinish:k},{default:n(()=>[a(g,{label:"选择仓库"},{default:n(()=>[a(Q,{value:u.warehouseId,"onUpdate:value":e[0]||(e[0]=o=>u.warehouseId=o),placeholder:"请选择要盘点的仓库",style:{width:"250px"},onChange:k,"allow-clear":""},{default:n(()=>[(s(!0),I(q,null,z(f(p).warehouses,o=>(s(),m(D,{key:o.id,value:o.id},{default:n(()=>[_(b(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(g,null,{default:n(()=>[a(C,{type:"primary","html-type":"submit",loading:f(l).loading},{default:n(()=>e[1]||(e[1]=[_("开始盘点",-1)])),_:1,__:[1]},8,["loading"])]),_:1})]),_:1},8,["model"]),a(N),a(F,{columns:w,"data-source":c.value,loading:f(l).loading,"row-key":"itemDefinitionId",pagination:!1},{bodyCell:n(({column:o,record:d})=>[o.key==="actualQuantity"?(s(),m(B,{key:0,value:d.actualQuantity,"onUpdate:value":L=>d.actualQuantity=L,min:0},null,8,["value","onUpdate:value"])):x("",!0),o.key==="difference"?(s(),m(V,{key:1,color:d.difference!==0?"red":"green"},{default:n(()=>[_(b(d.difference),1)]),_:2},1032,["color"])):x("",!0)]),_:1},8,["data-source","loading"])]),_:1})])])}}}),ee=G(J,[["__scopeId","data-v-8d650b62"]]);export{ee as default};
