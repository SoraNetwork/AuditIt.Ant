import{u as N}from"./itemStore-CsZIEJLU.js";import{u as M}from"./warehouseStore-BYRE3zWc.js";import{u as R}from"./itemDefinitionStore-C1Vll4sj.js";import{d as B,r as V,H as s,o as O,b as T,c as r,k as K,e as n,w as i,v as p,i as _,l as c,j as L,t as U,M as W,g as h,h as u}from"./index-zTJgZTqd.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"page-container"},E=B({__name:"Return",setup(H){const t=N(),d=M(),m=R(),a=V([]),f=s(()=>m.itemDefinitions.reduce((e,o)=>(e[o.id]=o,e),{})),g=s(()=>d.warehouses.reduce((e,o)=>(e[o.id]=o,e),{})),l=s(()=>t.items.map(e=>({...e,name:f.value[e.itemDefinitionId]?.name||"未知物品",warehouseName:g.value[e.warehouseId]?.name||"未知仓库"}))),v=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"原属仓库",dataIndex:"warehouseName",key:"warehouse"},{title:"UUID",dataIndex:"id",key:"id",ellipsis:!0}],y=e=>{a.value=e},I=s(()=>a.value.length>0),k=()=>{W.confirm({title:"确认归还",content:`您确定要归还选中的 ${a.value.length} 件物品吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{const e=a.value.map(o=>t.updateItemStatus(o,"return"));await Promise.all(e),h.success(`成功归还 ${a.value.length} 件物品!`),a.value=[],t.fetchItems({status:"LoanedOut"})}catch{h.error("归还失败")}}})};return O(()=>{t.fetchItems({status:"LoanedOut"}),d.fetchWarehouses(),m.fetchItemDefinitions()}),(e,o)=>{const w=n("a-page-header"),x=n("a-button"),b=n("a-space"),D=n("a-table"),S=n("a-empty"),C=n("a-card");return u(),T("div",null,[r(w,{title:"归还操作","sub-title":"将借出的物品归还入库"}),K("div",j,[r(C,null,{default:i(()=>[r(b,{style:{"margin-bottom":"16px"}},{default:i(()=>[r(x,{type:"primary",disabled:!I.value,loading:c(t).loading,onClick:k},{default:i(()=>[L(" 归还选中项 ("+U(a.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),!c(t).loading&&l.value.length>0?(u(),p(D,{key:0,"row-selection":{selectedRowKeys:a.value,onChange:y},columns:v,"data-source":l.value,loading:c(t).loading,"row-key":"id"},null,8,["row-selection","data-source","loading"])):_("",!0),!c(t).loading&&l.value.length===0?(u(),p(S,{key:1,description:"当前没有已借出的物品"})):_("",!0)]),_:1})])])}}}),G=$(E,[["__scopeId","data-v-40a3de60"]]);export{G as default};
