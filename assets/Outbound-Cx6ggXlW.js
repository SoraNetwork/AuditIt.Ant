import{u as E}from"./warehouseStore-DsaAtCfP.js";import{u as Q,g as z}from"./itemStore-C5V1qByR.js";import{d as A,L as G,r as M,K as y,o as H,e as w,c as n,n as J,g as o,f as l,y as h,F as X,v as Y,m as v,x as f,p as m,l as I,N as Z,D as k,i as b,O as ee,k as d}from"./index-BvDCns5E.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"page-container"},oe={key:0},se=A({__name:"Outbound",setup(ne){const x=E(),a=Q(),i=G({warehouseId:void 0}),_=M(""),r=M([]),S=y(()=>a.items.map(t=>({...t,name:t.itemDefinition?.name||"未知物品",warehouseName:t.warehouse?.name||"未知仓库"}))),C=y(()=>{if(!_.value)return S.value;const t=_.value.toLowerCase();return S.value.filter(e=>e.name&&e.name.toLowerCase().includes(t)||e.shortId&&e.shortId.toLowerCase().includes(t))}),B=[{title:"可视化ID",dataIndex:"shortId",key:"shortId"},{title:"物品名称",dataIndex:"name",key:"name"},{title:"当前状态",dataIndex:"status",key:"status"},{title:"所在仓库",dataIndex:"warehouseName",key:"warehouseName"},{title:"备注",dataIndex:"remarks",key:"remarks"}];H(()=>{x.fetchWarehouses()});const g=async()=>{if(i.warehouseId){await a.fetchItems({warehouseId:i.warehouseId,status:"InStock"});const t=[...a.items];await a.fetchItems({warehouseId:i.warehouseId,status:"SuspectedMissing"});const e=[...a.items],c=[...t,...e],u=new Set;a.items=c.filter(p=>u.has(p.id)?!1:(u.add(p.id),!0))}else a.items=[];r.value=[],_.value=""},V=t=>{r.value=t},D=y(()=>r.value.length>0),N=t=>{const e=t==="outbound"?"借出":"处置";let c;Z.confirm({title:`确认${e}`,content:k("div",[k("p",`您确定要将选中的 ${r.value.length} 件物品状态更新为 "${e}" 吗？`),k(ee,{placeholder:"请输入目的地（例如：借给某人，或处置原因）",onChange:u=>{c=u.target.value},style:{marginTop:"16px"}})]),okText:"确认",cancelText:"取消",onOk:async()=>{if(!c)return b.error("目的地不能为空"),Promise.reject();try{const u=r.value.map(p=>a.updateItemStatus(p,t,c));await Promise.all(u),b.success(`成功${e} ${r.value.length} 件物品!`),r.value=[],g()}catch{b.error(`${e}失败`)}}})},F=t=>{switch(t){case"InStock":return"green";case"LoanedOut":return"blue";case"Disposed":return"grey";case"SuspectedMissing":return"red";default:return"default"}};return(t,e)=>{const c=o("a-page-header"),u=o("a-select-option"),p=o("a-select"),$=o("a-form-item"),K=o("a-input-search"),P=o("a-form"),R=o("a-divider"),T=o("a-button"),U=o("a-space"),W=o("a-tag"),j=o("a-table"),L=o("a-empty"),q=o("a-card");return d(),w("div",null,[n(c,{title:"出库操作","sub-title":"更新在库或疑似丢失物品的状态"}),J("div",ae,[n(q,null,{default:l(()=>[n(P,{layout:"inline",model:i,onFinish:g},{default:l(()=>[n($,{label:"选择仓库"},{default:l(()=>[n(p,{value:i.warehouseId,"onUpdate:value":e[0]||(e[0]=s=>i.warehouseId=s),placeholder:"请选择仓库",style:{width:"200px"},onChange:g,"allow-clear":""},{default:l(()=>[(d(!0),w(X,null,Y(m(x).warehouses,s=>(d(),h(u,{key:s.id,value:s.id},{default:l(()=>[v(f(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n($,{label:"搜索"},{default:l(()=>[n(K,{value:_.value,"onUpdate:value":e[1]||(e[1]=s=>_.value=s),placeholder:"按名称或短ID搜索",style:{width:"200px"},"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"]),n(R),i.warehouseId?(d(),w("div",oe,[n(U,{style:{"margin-bottom":"16px"}},{default:l(()=>[n(T,{type:"primary",disabled:!D.value,loading:m(a).loading,onClick:e[2]||(e[2]=s=>N("outbound"))},{default:l(()=>[v(" 借出选中项 ("+f(r.value.length)+") ",1)]),_:1},8,["disabled","loading"]),n(T,{type:"primary",danger:"",disabled:!D.value,loading:m(a).loading,onClick:e[3]||(e[3]=s=>N("dispose"))},{default:l(()=>[v(" 处置选中项 ("+f(r.value.length)+") ",1)]),_:1},8,["disabled","loading"])]),_:1}),m(a).loading?I("",!0):(d(),h(j,{key:0,"row-selection":{selectedRowKeys:r.value,onChange:V},columns:B,"data-source":C.value,loading:m(a).loading,"row-key":"id"},{bodyCell:l(({column:s,record:O})=>[s.key==="status"?(d(),h(W,{key:0,color:F(O.status)},{default:l(()=>[v(f(m(z)(O.status)),1)]),_:2},1032,["color"])):I("",!0)]),_:1},8,["row-selection","data-source","loading"])),!m(a).loading&&C.value.length===0?(d(),h(L,{key:1,description:"该仓库中没有符合条件的物品"})):I("",!0)])):(d(),h(L,{key:1,description:"请先选择一个仓库以加载物品"}))]),_:1})])])}}}),ie=te(se,[["__scopeId","data-v-05f9a4f5"]]);export{ie as default};
