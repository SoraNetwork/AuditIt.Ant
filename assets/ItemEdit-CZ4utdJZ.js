import{d as S,r as g,L as V,K as E,s as P,o as $,h as j,i as v,j as D,e as h,c as s,n as k,p as d,g as a,y as m,f as l,l as O,P as K,m as M,k as i}from"./index-D9XwG3Jh.js";import{u as T}from"./itemStore-DWekEsjW.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"page-container"},A={key:0},G=S({__name:"ItemEdit",setup(H){const y=j(),p=D(),u=T(),n=g(null),o=V({remarks:""}),r=g([]),b=E(()=>n.value?.photoUrl?`${(P.defaults.baseURL||"").replace("/api","")}${n.value.photoUrl}`:"");$(async()=>{const t=y.params.id;await u.fetchItems({id:t});const e=u.items.find(c=>c.id===t);e?(n.value=e,o.remarks=e.remarks||""):(v.error("未找到物品"),p.back())});const I=t=>{t.fileList.length>0?(r.value=[t.fileList[t.fileList.length-1]],o.photo=t.file.originFileObj):(r.value=[],delete o.photo)},U=async()=>{if(n.value)try{const t=new FormData;t.append("Remarks",o.remarks),o.photo&&t.append("Photo",o.photo),await u.updateItem(n.value.id,t),v.success("物品信息已更新"),p.back()}catch{v.error("更新失败")}};return(t,e)=>{const c=a("a-page-header"),x=a("a-textarea"),_=a("a-form-item"),C=a("a-upload"),L=a("a-image"),w=a("a-empty"),B=a("a-button"),F=a("a-form"),N=a("a-card"),R=a("a-skeleton");return i(),h("div",null,[s(c,{title:`编辑物品: ${n.value?.shortId}`,onBack:e[0]||(e[0]=()=>d(p).back())},null,8,["title"]),k("div",z,[!d(u).loading&&n.value?(i(),m(N,{key:0},{default:l(()=>[s(F,{model:o,onFinish:U,layout:"vertical"},{default:l(()=>[s(_,{label:"备注"},{default:l(()=>[s(x,{value:o.remarks,"onUpdate:value":e[1]||(e[1]=f=>o.remarks=f),rows:4},null,8,["value"])]),_:1}),s(_,{label:"更换照片"},{default:l(()=>[s(C,{"file-list":r.value,"onUpdate:fileList":e[2]||(e[2]=f=>r.value=f),"before-upload":()=>!1,onChange:I,"list-type":"picture-card"},{default:l(()=>[!r.value||r.value.length<1?(i(),h("div",A,[s(d(K)),e[3]||(e[3]=k("div",{style:{"margin-top":"8px"}},"上传",-1))])):O("",!0)]),_:1},8,["file-list"]),e[4]||(e[4]=k("p",null,"当前照片:",-1)),n.value.photoUrl?(i(),m(L,{key:0,width:100,src:b.value},null,8,["src"])):(i(),m(w,{key:1,description:"暂无照片"}))]),_:1,__:[4]}),s(_,null,{default:l(()=>[s(B,{type:"primary","html-type":"submit",loading:d(u).loading},{default:l(()=>e[5]||(e[5]=[M(" 保存更改 ",-1)])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})):(i(),m(R,{key:1,active:""}))])])}}}),X=q(G,[["__scopeId","data-v-7634d73d"]]);export{X as default};
