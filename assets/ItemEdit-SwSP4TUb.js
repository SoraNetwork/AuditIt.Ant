import{d as V,r as y,L as $,K as E,s as R,o as j,h as O,i as v,j as P,e as g,c as a,n as k,p as m,g as t,y as d,f as r,l as K,P as M,m as T,k as i}from"./index-DUf6id1q.js";import{u as q}from"./itemStore-CKju-_Tv.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"page-container"},D={key:0},G=V({__name:"ItemEdit",setup(H){const b=O(),c=P(),u=q(),o=y(null),l=$({remarks:""}),n=y([]),h=E(()=>o.value?.photoUrl?`${(R.defaults.baseURL||"").replace(/\/api$/,"")}${o.value.photoUrl}`:null);j(async()=>{const s=b.params.id;await u.fetchItems({id:s});const e=u.items.find(p=>p.id===s);e?(o.value=e,l.remarks=e.remarks||""):(v.error("未找到物品"),c.back())});const x=s=>{n.value=s.fileList.slice(-1),n.value&&n.value.length>0?l.photo=n.value[0].originFileObj:l.photo=void 0},I=async()=>{if(o.value)try{await u.updateItem(o.value.id,l),v.success("物品信息已更新"),c.back()}catch{v.error("更新失败")}};return(s,e)=>{const p=t("a-page-header"),U=t("a-textarea"),_=t("a-form-item"),C=t("a-upload"),w=t("a-image"),B=t("a-empty"),L=t("a-button"),F=t("a-form"),N=t("a-card"),S=t("a-skeleton");return i(),g("div",null,[a(p,{title:`编辑物品: ${o.value?.shortId}`,onBack:e[0]||(e[0]=()=>m(c).back())},null,8,["title"]),k("div",A,[!m(u).loading&&o.value?(i(),d(N,{key:0},{default:r(()=>[a(F,{model:l,onFinish:I,layout:"vertical"},{default:r(()=>[a(_,{label:"备注"},{default:r(()=>[a(U,{value:l.remarks,"onUpdate:value":e[1]||(e[1]=f=>l.remarks=f),rows:4},null,8,["value"])]),_:1}),a(_,{label:"更换照片"},{default:r(()=>[a(C,{"file-list":n.value,"onUpdate:fileList":e[2]||(e[2]=f=>n.value=f),"before-upload":()=>!1,onChange:x,"list-type":"picture-card","max-count":1},{default:r(()=>[!n.value||n.value.length<1?(i(),g("div",D,[a(m(M)),e[3]||(e[3]=k("div",{style:{"margin-top":"8px"}},"上传",-1))])):K("",!0)]),_:1},8,["file-list"]),e[4]||(e[4]=k("p",null,"当前照片:",-1)),o.value.photoUrl?(i(),d(w,{key:0,width:100,src:h.value},null,8,["src"])):(i(),d(B,{key:1,description:"暂无照片"}))]),_:1,__:[4]}),a(_,null,{default:r(()=>[a(L,{type:"primary","html-type":"submit",loading:m(u).loading},{default:r(()=>e[5]||(e[5]=[T(" 保存更改 ",-1)])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})):(i(),d(S,{key:1,active:""}))])])}}}),X=z(G,[["__scopeId","data-v-1b0183b3"]]);export{X as default};
