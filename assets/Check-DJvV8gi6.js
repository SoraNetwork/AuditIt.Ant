import{d as U,r as p,L as W,e as X,c as e,n as f,g as s,f as t,R as K,T,m as g,y as $,l as j,U as F,x as h,i as O,k as D}from"./index-CDOnwa1F.js";import{u as P}from"./itemStore-MAwbgp0Y.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"page-container"},q={class:"item-name"},H={class:"item-short-id"},J=U({__name:"Check",setup(Z){const y=P(),u=p(""),i=p(!1),v=p([]),I=new Set,S=p(null),b=p(0),n=W({success:0,failed:0,duplicate:0}),R=new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaXRyYXRlOjMyMGtiL3MA"),k=new Audio("data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaXRyYXRlOjI1NmtiL3MA"),B=async()=>{const d=Date.now(),a=u.value.trim();if(!a||a===S.value&&d-b.value<500)return;S.value=a,b.value=d;const l=a;if(i.value=!0,I.has(l)){n.duplicate++,w({shortId:l,name:"重复扫描",message:"该物品已在本次盘点中扫描过。",status:"重复",tagColor:"orange"}),u.value="",i.value=!1,k.play().catch(o=>console.error("Audio play failed:",o));return}try{await y.fetchItems({shortId:l});const o=y.items.find(r=>r.shortId===l);if(!o)throw new Error("物品未在系统中找到");const _=o.status,A=await y.updateItemStatus(o.id,"check");n.success++,I.add(l),w({shortId:l,name:A.itemDefinition?.name||"未知物品",message:`原状态: ${_} -> 新状态: ${A.status}`,status:"成功",tagColor:"green"}),R.play().catch(r=>console.error("Audio play failed:",r))}catch(o){n.failed++,w({shortId:l,name:"操作失败",message:o.message||"未知错误",status:"失败",tagColor:"red"}),k.play().catch(_=>console.error("Audio play failed:",_))}finally{u.value="",i.value=!1}},w=d=>{v.value.unshift(d)},x=()=>{v.value=[],I.clear(),n.success=0,n.failed=0,n.duplicate=0,O.info("结果已清空")};return(d,a)=>{const l=s("a-page-header"),o=s("a-button"),_=s("a-input-search"),A=s("a-form-item"),r=s("a-divider"),C=s("a-statistic"),m=s("a-col"),V=s("a-row"),Y=s("a-list-item-meta"),L=s("a-tag"),M=s("a-list-item"),N=s("a-list"),z=s("a-empty"),E=s("a-card");return D(),X("div",null,[e(l,{title:"连续盘点","sub-title":"使用扫描枪或手动输入短ID进行快速盘点"}),f("div",G,[e(E,null,{default:t(()=>[e(V,{gutter:24},{default:t(()=>[e(m,{span:8},{default:t(()=>[e(A,{label:"扫描或输入物品短ID"},{default:t(()=>[e(_,{value:u.value,"onUpdate:value":a[0]||(a[0]=c=>u.value=c),placeholder:"在此处扫描或输入ID...",size:"large",autofocus:"",onSearch:B,onKeydown:K(T(B,["prevent"]),["enter"])},{enterButton:t(()=>[e(o,{type:"primary"},{default:t(()=>a[1]||(a[1]=[g("盘点",-1)])),_:1,__:[1]})]),_:1},8,["value","onKeydown"])]),_:1}),e(r,null,{default:t(()=>a[2]||(a[2]=[g("统计",-1)])),_:1,__:[2]}),e(V,{gutter:16},{default:t(()=>[e(m,{span:8},{default:t(()=>[e(C,{title:"成功",value:n.success},null,8,["value"])]),_:1}),e(m,{span:8},{default:t(()=>[e(C,{title:"失败",value:n.failed},null,8,["value"])]),_:1}),e(m,{span:8},{default:t(()=>[e(C,{title:"重复",value:n.duplicate},null,8,["value"])]),_:1})]),_:1}),e(r),e(o,{onClick:x,block:""},{default:t(()=>a[3]||(a[3]=[g("清空列表",-1)])),_:1,__:[3]})]),_:1}),e(m,{span:16},{default:t(()=>[e(N,{"data-source":v.value,bordered:"",loading:i.value},{renderItem:t(({item:c})=>[e(M,{class:F(`status-${c.status.toLowerCase()}`)},{actions:t(()=>[e(L,{color:c.tagColor},{default:t(()=>[g(h(c.status),1)]),_:2},1032,["color"])]),default:t(()=>[e(Y,null,{title:t(()=>[f("span",q,h(c.name),1),f("span",H," ("+h(c.shortId)+")",1)]),description:t(()=>[f("span",null,h(c.message),1)]),_:2},1024)]),_:2},1032,["class"])]),header:t(()=>a[4]||(a[4]=[f("div",null,"盘点结果 (最新扫描的在最上方)",-1)])),_:1},8,["data-source","loading"]),v.value.length===0&&!i.value?(D(),$(z,{key:0,description:"请开始扫描...",style:{"margin-top":"24px"}})):j("",!0)]),_:1})]),_:1})]),_:1})])])}}}),se=Q(J,[["__scopeId","data-v-386b4bea"]]);export{se as default};
