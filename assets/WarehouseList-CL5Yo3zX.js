import{u as $}from"./warehouseStore-BYRE3zWc.js";import{d as V,r as p,J as E,s as F,v as I,w as o,c as t,e as s,E as S,h as b,H as q,o as T,b as A,l as w,i as D,k as x,j as H,g as m}from"./index-zTJgZTqd.js";const J=V({__name:"WarehouseForm",props:{initialValues:{type:Object,default:()=>({})}},setup(g,{expose:n}){const _=g,i=p(),e=E({name:"",location:"",capacity:0,description:""}),c={name:[{required:!0,message:"请输入仓库名称！"}],location:[{required:!0,message:"请输入仓库位置！"}]};return F(()=>_.initialValues,d=>{d&&Object.assign(e,d)},{immediate:!0,deep:!0}),n({validate:async()=>{if(i.value)return await i.value.validate(),S(e)}}),(d,r)=>{const f=s("a-input"),u=s("a-form-item"),v=s("a-input-number"),y=s("a-textarea"),l=s("a-form");return b(),I(l,{ref_key:"formRef",ref:i,model:e,rules:c,layout:"vertical",name:"warehouse_form"},{default:o(()=>[t(u,{label:"仓库名称",name:"name"},{default:o(()=>[t(f,{value:e.name,"onUpdate:value":r[0]||(r[0]=a=>e.name=a)},null,8,["value"])]),_:1}),t(u,{label:"位置",name:"location"},{default:o(()=>[t(f,{value:e.location,"onUpdate:value":r[1]||(r[1]=a=>e.location=a)},null,8,["value"])]),_:1}),t(u,{label:"容量",name:"capacity"},{default:o(()=>[t(v,{value:e.capacity,"onUpdate:value":r[2]||(r[2]=a=>e.capacity=a),style:{width:"100%"}},null,8,["value"])]),_:1}),t(u,{label:"描述",name:"description"},{default:o(()=>[t(y,{value:e.description,"onUpdate:value":r[3]||(r[3]=a=>e.description=a)},null,8,["value"])]),_:1})]),_:1},8,["model"])}}}),L=["onClick"],K=V({__name:"WarehouseList",setup(g){const n=$(),_=p(null),i=p(!1),e=p(null),c=p({}),h=q(()=>e.value!==null?"编辑仓库":"添加仓库"),d=[{title:"名称",dataIndex:"name",key:"name"},{title:"位置",dataIndex:"location",key:"location"},{title:"容量",dataIndex:"capacity",key:"capacity"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:"150px"}],r=()=>{e.value=null,c.value={name:"",location:"",capacity:100,description:""},i.value=!0},f=l=>{e.value=l.id,c.value={...l},i.value=!0},u=async l=>{await n.deleteWarehouse(l),n.error?m.error(n.error):m.success("仓库删除成功")},v=async()=>{try{const l=await _.value?.validate();if(!l)return;e.value!==null?await n.updateWarehouse({id:e.value,...l}):await n.addWarehouse(l),n.error?m.error(n.error):(m.success(`仓库${e.value!==null?"更新":"添加"}成功`),i.value=!1)}catch(l){console.log("表单校验失败:",l),m.error("请检查表单填写是否正确")}},y=()=>{i.value=!1};return T(()=>{n.fetchWarehouses()}),(l,a)=>{const C=s("a-col"),R=s("a-button"),U=s("a-row"),j=s("a-popconfirm"),B=s("a-space"),M=s("a-table"),N=s("a-modal");return b(),A("div",null,[t(M,{columns:d,"data-source":w(n).warehouses,loading:w(n).loading,"row-key":"id"},{title:o(()=>[t(U,{justify:"space-between"},{default:o(()=>[t(C,null,{default:o(()=>a[1]||(a[1]=[x("h2",null,"仓库管理",-1)])),_:1,__:[1]}),t(C,null,{default:o(()=>[t(R,{type:"primary",onClick:r},{default:o(()=>a[2]||(a[2]=[H("添加仓库",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),bodyCell:o(({column:k,record:W})=>[k.key==="action"?(b(),I(B,{key:0},{default:o(()=>[x("a",{onClick:O=>f(W)},"编辑",8,L),t(j,{title:"您确定要删除这个仓库吗？",onConfirm:O=>u(W.id),"ok-text":"确定","cancel-text":"取消"},{default:o(()=>a[3]||(a[3]=[x("a",{style:{color:"red"}},"删除",-1)])),_:2,__:[3]},1032,["onConfirm"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading"]),t(N,{open:i.value,"onUpdate:open":a[0]||(a[0]=k=>i.value=k),title:h.value,"confirm-loading":w(n).loading,onOk:v,onCancel:y,"ok-text":"保存","cancel-text":"取消"},{default:o(()=>[t(J,{ref_key:"warehouseFormRef",ref:_,"initial-values":c.value},null,8,["initial-values"])]),_:1},8,["open","title","confirm-loading"])])}}});export{K as default};
