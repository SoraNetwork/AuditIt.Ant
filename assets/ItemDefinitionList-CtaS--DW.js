import{u as F}from"./itemDefinitionStore-cpDZ5L6q.js";import{u as O}from"./categoryStore-ChBEvGGy.js";import{_ as R}from"./ItemDefinitionForm.vue_vue_type_script_setup_true_lang-Csmg4xr7.js";import{d as T,r as u,D as f,o as L,b as U,c as n,w as a,l as p,e as l,p as q,i as z,k as _,j as G,g as s,h as k}from"./index-DUkmHRbR.js";const H=["onClick"],X=T({__name:"ItemDefinitionList",setup(J){const t=F(),c=O(),v=u(null),i=u(!1),r=u(null),d=u({}),C=f(()=>r.value!==null?"编辑物品定义":"添加物品定义"),I=f(()=>c.categories.reduce((e,o)=>(e[o.id]=o.name,e),{})),w=f(()=>t.itemDefinitions.map(e=>({...e,categoryName:I.value[e.categoryId]||"N/A"}))),x=[{title:"名称",dataIndex:"name",key:"name"},{title:"分类",dataIndex:"categoryName",key:"category"},{title:"单位",dataIndex:"unit",key:"unit"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:"150px"}],D=()=>{r.value=null,d.value={name:"",categoryId:void 0,unit:"",description:""},i.value=!0},b=e=>{r.value=e.id,d.value={...e},i.value=!0},h=async e=>{await t.deleteItemDefinition(e),t.error?s.error(t.error):s.success("物品定义删除成功")},N=async()=>{try{const e=await v.value?.validate();if(!e)return;r.value!==null?await t.updateItemDefinition({id:r.value,...e}):await t.addItemDefinition(e),t.error?s.error(t.error):(s.success(`物品定义${r.value!==null?"更新":"添加"}成功`),i.value=!1)}catch(e){console.log("表单校验失败:",e),s.error("请检查表单填写是否正确")}},M=()=>{i.value=!1};return L(()=>{t.fetchItemDefinitions(),c.categories.length===0&&c.fetchCategories()}),(e,o)=>{const y=l("a-col"),V=l("a-button"),B=l("a-row"),S=l("a-popconfirm"),$=l("a-space"),j=l("a-table"),A=l("a-modal");return k(),U("div",null,[n(j,{columns:x,"data-source":w.value,loading:p(t).loading||p(c).loading,"row-key":"id"},{title:a(()=>[n(B,{justify:"space-between"},{default:a(()=>[n(y,null,{default:a(()=>o[1]||(o[1]=[_("h2",null,"物品定义管理",-1)])),_:1,__:[1]}),n(y,null,{default:a(()=>[n(V,{type:"primary",onClick:D},{default:a(()=>o[2]||(o[2]=[G("添加物品定义",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),bodyCell:a(({column:m,record:g})=>[m.key==="action"?(k(),q($,{key:0},{default:a(()=>[_("a",{onClick:E=>b(g)},"编辑",8,H),n(S,{title:"您确定要删除这个物品定义吗？",onConfirm:E=>h(g.id),"ok-text":"确定","cancel-text":"取消"},{default:a(()=>o[3]||(o[3]=[_("a",{style:{color:"red"}},"删除",-1)])),_:2,__:[3]},1032,["onConfirm"])]),_:2},1024)):z("",!0)]),_:1},8,["data-source","loading"]),n(A,{open:i.value,"onUpdate:open":o[0]||(o[0]=m=>i.value=m),title:C.value,"confirm-loading":p(t).loading,onOk:N,onCancel:M,"ok-text":"保存","cancel-text":"取消"},{default:a(()=>[n(R,{ref_key:"itemDefFormRef",ref:v,"initial-values":d.value},null,8,["initial-values"])]),_:1},8,["open","title","confirm-loading"])])}}});export{X as default};
